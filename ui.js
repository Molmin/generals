"use strict";(()=>{var Ko=Object.create;var Ut=Object.defineProperty;var Jo=Object.getOwnPropertyDescriptor;var Xo=Object.getOwnPropertyNames;var Yo=Object.getPrototypeOf,jo=Object.prototype.hasOwnProperty;var h=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),zr=(t,e)=>{for(var r in e)Ut(t,r,{get:e[r],enumerable:!0})},Qo=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Xo(e))!jo.call(t,o)&&o!==r&&Ut(t,o,{get:()=>e[o],enumerable:!(n=Jo(e,o))||n.enumerable});return t};var De=(t,e,r)=>(r=t!=null?Ko(Yo(t)):{},Qo(e||!t||!t.__esModule?Ut(r,"default",{value:t,enumerable:!0}):r,t));var Wr=h((Vl,Ht)=>{typeof Ht<"u"&&(Ht.exports=I);function I(t){if(t)return Zo(t)}function Zo(t){for(var e in I.prototype)t[e]=I.prototype[e];return t}I.prototype.on=I.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};I.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this};I.prototype.off=I.prototype.removeListener=I.prototype.removeAllListeners=I.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+t];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,o=0;o<r.length;o++)if(n=r[o],n===e||n.fn===e){r.splice(o,1);break}return r.length===0&&delete this._callbacks["$"+t],this};I.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,o=r.length;n<o;++n)r[n].apply(this,e)}return this};I.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};I.prototype.hasListeners=function(t){return!!this.listeners(t).length}});var Yr=h((Kl,Xr)=>{Xr.exports=Ie;Ie.default=Ie;Ie.stable=Kr;Ie.stableStringify=Kr;var nt="[...]",Gr="[Circular]",ne=[],re=[];function Vr(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Ie(t,e,r,n){typeof n>"u"&&(n=Vr()),zt(t,"",0,[],void 0,0,n);var o;try{re.length===0?o=JSON.stringify(t,e,r):o=JSON.stringify(t,Jr(e),r)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ne.length!==0;){var i=ne.pop();i.length===4?Object.defineProperty(i[0],i[1],i[3]):i[0][i[1]]=i[2]}}return o}function de(t,e,r,n){var o=Object.getOwnPropertyDescriptor(n,r);o.get!==void 0?o.configurable?(Object.defineProperty(n,r,{value:t}),ne.push([n,r,e,o])):re.push([e,r,t]):(n[r]=t,ne.push([n,r,e]))}function zt(t,e,r,n,o,i,s){i+=1;var a;if(typeof t=="object"&&t!==null){for(a=0;a<n.length;a++)if(n[a]===t){de(Gr,t,e,o);return}if(typeof s.depthLimit<"u"&&i>s.depthLimit){de(nt,t,e,o);return}if(typeof s.edgesLimit<"u"&&r+1>s.edgesLimit){de(nt,t,e,o);return}if(n.push(t),Array.isArray(t))for(a=0;a<t.length;a++)zt(t[a],a,a,n,t,i,s);else{var l=Object.keys(t);for(a=0;a<l.length;a++){var c=l[a];zt(t[c],c,a,n,t,i,s)}}n.pop()}}function es(t,e){return t<e?-1:t>e?1:0}function Kr(t,e,r,n){typeof n>"u"&&(n=Vr());var o=Wt(t,"",0,[],void 0,0,n)||t,i;try{re.length===0?i=JSON.stringify(o,e,r):i=JSON.stringify(o,Jr(e),r)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ne.length!==0;){var s=ne.pop();s.length===4?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return i}function Wt(t,e,r,n,o,i,s){i+=1;var a;if(typeof t=="object"&&t!==null){for(a=0;a<n.length;a++)if(n[a]===t){de(Gr,t,e,o);return}try{if(typeof t.toJSON=="function")return}catch{return}if(typeof s.depthLimit<"u"&&i>s.depthLimit){de(nt,t,e,o);return}if(typeof s.edgesLimit<"u"&&r+1>s.edgesLimit){de(nt,t,e,o);return}if(n.push(t),Array.isArray(t))for(a=0;a<t.length;a++)Wt(t[a],a,a,n,t,i,s);else{var l={},c=Object.keys(t).sort(es);for(a=0;a<c.length;a++){var f=c[a];Wt(t[f],f,a,n,t,i,s),l[f]=t[f]}if(typeof o<"u")ne.push([o,e,t]),o[e]=l;else return l}n.pop()}}function Jr(t){return t=typeof t<"u"?t:function(e,r){return r},function(e,r){if(re.length>0)for(var n=0;n<re.length;n++){var o=re[n];if(o[1]===e&&o[0]===r){r=o[2],re.splice(n,1);break}}return t.call(this,e,r)}}});var Qr=h((Jl,jr)=>{"use strict";jr.exports=Error});var en=h((Xl,Zr)=>{"use strict";Zr.exports=EvalError});var rn=h((Yl,tn)=>{"use strict";tn.exports=RangeError});var on=h((jl,nn)=>{"use strict";nn.exports=ReferenceError});var Gt=h((Ql,sn)=>{"use strict";sn.exports=SyntaxError});var ye=h((Zl,an)=>{"use strict";an.exports=TypeError});var cn=h((ec,ln)=>{"use strict";ln.exports=URIError});var fn=h((tc,un)=>{"use strict";un.exports=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},r=Symbol("test"),n=Object(r);if(typeof r=="string"||Object.prototype.toString.call(r)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var o=42;e[r]=o;for(r in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var i=Object.getOwnPropertySymbols(e);if(i.length!==1||i[0]!==r||!Object.prototype.propertyIsEnumerable.call(e,r))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var s=Object.getOwnPropertyDescriptor(e,r);if(s.value!==o||s.enumerable!==!0)return!1}return!0}});var dn=h((rc,hn)=>{"use strict";var pn=typeof Symbol<"u"&&Symbol,ts=fn();hn.exports=function(){return typeof pn!="function"||typeof Symbol!="function"||typeof pn("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:ts()}});var mn=h((nc,yn)=>{"use strict";var Vt={__proto__:null,foo:{}},rs=Object;yn.exports=function(){return{__proto__:Vt}.foo===Vt.foo&&!(Vt instanceof rs)}});var bn=h((ic,wn)=>{"use strict";var ns="Function.prototype.bind called on incompatible ",is=Object.prototype.toString,os=Math.max,ss="[object Function]",gn=function(e,r){for(var n=[],o=0;o<e.length;o+=1)n[o]=e[o];for(var i=0;i<r.length;i+=1)n[i+e.length]=r[i];return n},as=function(e,r){for(var n=[],o=r||0,i=0;o<e.length;o+=1,i+=1)n[i]=e[o];return n},ls=function(t,e){for(var r="",n=0;n<t.length;n+=1)r+=t[n],n+1<t.length&&(r+=e);return r};wn.exports=function(e){var r=this;if(typeof r!="function"||is.apply(r)!==ss)throw new TypeError(ns+r);for(var n=as(arguments,1),o,i=function(){if(this instanceof o){var f=r.apply(this,gn(n,arguments));return Object(f)===f?f:this}return r.apply(e,gn(n,arguments))},s=os(0,r.length-n.length),a=[],l=0;l<s;l++)a[l]="$"+l;if(o=Function("binder","return function ("+ls(a,",")+"){ return binder.apply(this,arguments); }")(i),r.prototype){var c=function(){};c.prototype=r.prototype,o.prototype=new c,c.prototype=null}return o}});var it=h((oc,vn)=>{"use strict";var cs=bn();vn.exports=Function.prototype.bind||cs});var En=h((sc,Sn)=>{"use strict";var us=Function.prototype.call,fs=Object.prototype.hasOwnProperty,ps=it();Sn.exports=ps.call(us,fs)});var se=h((ac,On)=>{"use strict";var d,hs=Qr(),ds=en(),ys=rn(),ms=on(),be=Gt(),we=ye(),gs=cn(),Tn=Function,Kt=function(t){try{return Tn('"use strict"; return ('+t+").constructor;")()}catch{}},ie=Object.getOwnPropertyDescriptor;if(ie)try{ie({},"")}catch{ie=null}var Jt=function(){throw new we},ws=ie?function(){try{return arguments.callee,Jt}catch{try{return ie(arguments,"callee").get}catch{return Jt}}}():Jt,me=dn()(),bs=mn()(),T=Object.getPrototypeOf||(bs?function(t){return t.__proto__}:null),ge={},vs=typeof Uint8Array>"u"||!T?d:T(Uint8Array),oe={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?d:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?d:ArrayBuffer,"%ArrayIteratorPrototype%":me&&T?T([][Symbol.iterator]()):d,"%AsyncFromSyncIteratorPrototype%":d,"%AsyncFunction%":ge,"%AsyncGenerator%":ge,"%AsyncGeneratorFunction%":ge,"%AsyncIteratorPrototype%":ge,"%Atomics%":typeof Atomics>"u"?d:Atomics,"%BigInt%":typeof BigInt>"u"?d:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?d:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?d:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?d:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":hs,"%eval%":eval,"%EvalError%":ds,"%Float32Array%":typeof Float32Array>"u"?d:Float32Array,"%Float64Array%":typeof Float64Array>"u"?d:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?d:FinalizationRegistry,"%Function%":Tn,"%GeneratorFunction%":ge,"%Int8Array%":typeof Int8Array>"u"?d:Int8Array,"%Int16Array%":typeof Int16Array>"u"?d:Int16Array,"%Int32Array%":typeof Int32Array>"u"?d:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":me&&T?T(T([][Symbol.iterator]())):d,"%JSON%":typeof JSON=="object"?JSON:d,"%Map%":typeof Map>"u"?d:Map,"%MapIteratorPrototype%":typeof Map>"u"||!me||!T?d:T(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?d:Promise,"%Proxy%":typeof Proxy>"u"?d:Proxy,"%RangeError%":ys,"%ReferenceError%":ms,"%Reflect%":typeof Reflect>"u"?d:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?d:Set,"%SetIteratorPrototype%":typeof Set>"u"||!me||!T?d:T(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?d:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":me&&T?T(""[Symbol.iterator]()):d,"%Symbol%":me?Symbol:d,"%SyntaxError%":be,"%ThrowTypeError%":ws,"%TypedArray%":vs,"%TypeError%":we,"%Uint8Array%":typeof Uint8Array>"u"?d:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?d:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?d:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?d:Uint32Array,"%URIError%":gs,"%WeakMap%":typeof WeakMap>"u"?d:WeakMap,"%WeakRef%":typeof WeakRef>"u"?d:WeakRef,"%WeakSet%":typeof WeakSet>"u"?d:WeakSet};if(T)try{null.error}catch(t){_n=T(T(t)),oe["%Error.prototype%"]=_n}var _n,Ss=function t(e){var r;if(e==="%AsyncFunction%")r=Kt("async function () {}");else if(e==="%GeneratorFunction%")r=Kt("function* () {}");else if(e==="%AsyncGeneratorFunction%")r=Kt("async function* () {}");else if(e==="%AsyncGenerator%"){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var o=t("%AsyncGenerator%");o&&T&&(r=T(o.prototype))}return oe[e]=r,r},An={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ne=it(),ot=En(),Es=Ne.call(Function.call,Array.prototype.concat),_s=Ne.call(Function.apply,Array.prototype.splice),xn=Ne.call(Function.call,String.prototype.replace),st=Ne.call(Function.call,String.prototype.slice),As=Ne.call(Function.call,RegExp.prototype.exec),xs=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ts=/\\(\\)?/g,Os=function(e){var r=st(e,0,1),n=st(e,-1);if(r==="%"&&n!=="%")throw new be("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&r!=="%")throw new be("invalid intrinsic syntax, expected opening `%`");var o=[];return xn(e,xs,function(i,s,a,l){o[o.length]=a?xn(l,Ts,"$1"):s||i}),o},ks=function(e,r){var n=e,o;if(ot(An,n)&&(o=An[n],n="%"+o[0]+"%"),ot(oe,n)){var i=oe[n];if(i===ge&&(i=Ss(n)),typeof i>"u"&&!r)throw new we("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:o,name:n,value:i}}throw new be("intrinsic "+e+" does not exist!")};On.exports=function(e,r){if(typeof e!="string"||e.length===0)throw new we("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof r!="boolean")throw new we('"allowMissing" argument must be a boolean');if(As(/^%?[^%]*%?$/,e)===null)throw new be("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=Os(e),o=n.length>0?n[0]:"",i=ks("%"+o+"%",r),s=i.name,a=i.value,l=!1,c=i.alias;c&&(o=c[0],_s(n,Es([0,1],c)));for(var f=1,p=!0;f<n.length;f+=1){var u=n[f],m=st(u,0,1),v=st(u,-1);if((m==='"'||m==="'"||m==="`"||v==='"'||v==="'"||v==="`")&&m!==v)throw new be("property names with quotes must have matching quotes");if((u==="constructor"||!p)&&(l=!0),o+="."+u,s="%"+o+"%",ot(oe,s))a=oe[s];else if(a!=null){if(!(u in a)){if(!r)throw new we("base intrinsic for "+e+" exists, but the property is not available.");return}if(ie&&f+1>=n.length){var x=ie(a,u);p=!!x,p&&"get"in x&&!("originalValue"in x.get)?a=x.get:a=a[u]}else p=ot(a,u),a=a[u];p&&!l&&(oe[s]=a)}}return a}});var lt=h((lc,kn)=>{"use strict";var Rs=se(),at=Rs("%Object.defineProperty%",!0)||!1;if(at)try{at({},"a",{value:1})}catch{at=!1}kn.exports=at});var Xt=h((cc,Rn)=>{"use strict";var Cs=se(),ct=Cs("%Object.getOwnPropertyDescriptor%",!0);if(ct)try{ct([],"length")}catch{ct=null}Rn.exports=ct});var Dn=h((uc,$n)=>{"use strict";var Cn=lt(),Ps=Gt(),ve=ye(),Pn=Xt();$n.exports=function(e,r,n){if(!e||typeof e!="object"&&typeof e!="function")throw new ve("`obj` must be an object or a function`");if(typeof r!="string"&&typeof r!="symbol")throw new ve("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new ve("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new ve("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new ve("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new ve("`loose`, if provided, must be a boolean");var o=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,s=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,l=!!Pn&&Pn(e,r);if(Cn)Cn(e,r,{configurable:s===null&&l?l.configurable:!s,enumerable:o===null&&l?l.enumerable:!o,value:n,writable:i===null&&l?l.writable:!i});else if(a||!o&&!i&&!s)e[r]=n;else throw new Ps("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")}});var Ln=h((fc,Nn)=>{"use strict";var Yt=lt(),In=function(){return!!Yt};In.hasArrayLengthDefineBug=function(){if(!Yt)return null;try{return Yt([],"length",{value:1}).length!==1}catch{return!0}};Nn.exports=In});var Un=h((pc,Mn)=>{"use strict";var $s=se(),Bn=Dn(),Ds=Ln()(),qn=Xt(),Fn=ye(),Is=$s("%Math.floor%");Mn.exports=function(e,r){if(typeof e!="function")throw new Fn("`fn` is not a function");if(typeof r!="number"||r<0||r>4294967295||Is(r)!==r)throw new Fn("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],o=!0,i=!0;if("length"in e&&qn){var s=qn(e,"length");s&&!s.configurable&&(o=!1),s&&!s.writable&&(i=!1)}return(o||i||!n)&&(Ds?Bn(e,"length",r,!0,!0):Bn(e,"length",r)),e}});var Kn=h((hc,ut)=>{"use strict";var jt=it(),ft=se(),Ns=Un(),Ls=ye(),Wn=ft("%Function.prototype.apply%"),Gn=ft("%Function.prototype.call%"),Vn=ft("%Reflect.apply%",!0)||jt.call(Gn,Wn),Hn=lt(),Bs=ft("%Math.max%");ut.exports=function(e){if(typeof e!="function")throw new Ls("a function is required");var r=Vn(jt,Gn,arguments);return Ns(r,1+Bs(0,e.length-(arguments.length-1)),!0)};var zn=function(){return Vn(jt,Wn,arguments)};Hn?Hn(ut.exports,"apply",{value:zn}):ut.exports.apply=zn});var jn=h((dc,Yn)=>{"use strict";var Jn=se(),Xn=Kn(),qs=Xn(Jn("String.prototype.indexOf"));Yn.exports=function(e,r){var n=Jn(e,!!r);return typeof n=="function"&&qs(e,".prototype.")>-1?Xn(n):n}});var Qn=h(()=>{});var wi=h((gc,gi)=>{var ar=typeof Map=="function"&&Map.prototype,Qt=Object.getOwnPropertyDescriptor&&ar?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,ht=ar&&Qt&&typeof Qt.get=="function"?Qt.get:null,Zn=ar&&Map.prototype.forEach,lr=typeof Set=="function"&&Set.prototype,Zt=Object.getOwnPropertyDescriptor&&lr?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,dt=lr&&Zt&&typeof Zt.get=="function"?Zt.get:null,ei=lr&&Set.prototype.forEach,Fs=typeof WeakMap=="function"&&WeakMap.prototype,Be=Fs?WeakMap.prototype.has:null,Ms=typeof WeakSet=="function"&&WeakSet.prototype,qe=Ms?WeakSet.prototype.has:null,Us=typeof WeakRef=="function"&&WeakRef.prototype,ti=Us?WeakRef.prototype.deref:null,Hs=Boolean.prototype.valueOf,zs=Object.prototype.toString,Ws=Function.prototype.toString,Gs=String.prototype.match,cr=String.prototype.slice,j=String.prototype.replace,Vs=String.prototype.toUpperCase,ri=String.prototype.toLowerCase,fi=RegExp.prototype.test,ni=Array.prototype.concat,q=Array.prototype.join,Ks=Array.prototype.slice,ii=Math.floor,rr=typeof BigInt=="function"?BigInt.prototype.valueOf:null,er=Object.getOwnPropertySymbols,nr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Se=typeof Symbol=="function"&&typeof Symbol.iterator=="object",k=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Se||!0)?Symbol.toStringTag:null,pi=Object.prototype.propertyIsEnumerable,oi=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function si(t,e){if(t===1/0||t===-1/0||t!==t||t&&t>-1e3&&t<1e3||fi.call(/e/,e))return e;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof t=="number"){var n=t<0?-ii(-t):ii(t);if(n!==t){var o=String(n),i=cr.call(e,o.length+1);return j.call(o,r,"$&_")+"."+j.call(j.call(i,/([0-9]{3})/g,"$&_"),/_$/,"")}}return j.call(e,r,"$&_")}var ir=Qn(),ai=ir.custom,li=di(ai)?ai:null;gi.exports=function t(e,r,n,o){var i=r||{};if(Y(i,"quoteStyle")&&i.quoteStyle!=="single"&&i.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Y(i,"maxStringLength")&&(typeof i.maxStringLength=="number"?i.maxStringLength<0&&i.maxStringLength!==1/0:i.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var s=Y(i,"customInspect")?i.customInspect:!0;if(typeof s!="boolean"&&s!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Y(i,"indent")&&i.indent!==null&&i.indent!=="	"&&!(parseInt(i.indent,10)===i.indent&&i.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Y(i,"numericSeparator")&&typeof i.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=i.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return mi(e,i);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var l=String(e);return a?si(e,l):l}if(typeof e=="bigint"){var c=String(e)+"n";return a?si(e,c):c}var f=typeof i.depth>"u"?5:i.depth;if(typeof n>"u"&&(n=0),n>=f&&f>0&&typeof e=="object")return or(e)?"[Array]":"[Object]";var p=fa(i,n);if(typeof o>"u")o=[];else if(yi(o,e)>=0)return"[Circular]";function u(L,J,X){if(J&&(o=Ks.call(o),o.push(J)),X){var $e={depth:i.depth};return Y(i,"quoteStyle")&&($e.quoteStyle=i.quoteStyle),t(L,$e,n+1,o)}return t(L,i,n+1,o)}if(typeof e=="function"&&!ci(e)){var m=ra(e),v=pt(e,u);return"[Function"+(m?": "+m:" (anonymous)")+"]"+(v.length>0?" { "+q.call(v,", ")+" }":"")}if(di(e)){var x=Se?j.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):nr.call(e);return typeof e=="object"&&!Se?Le(x):x}if(la(e)){for(var P="<"+ri.call(String(e.nodeName)),D=e.attributes||[],G=0;G<D.length;G++)P+=" "+D[G].name+"="+hi(Js(D[G].value),"double",i);return P+=">",e.childNodes&&e.childNodes.length&&(P+="..."),P+="</"+ri.call(String(e.nodeName))+">",P}if(or(e)){if(e.length===0)return"[]";var g=pt(e,u);return p&&!ua(g)?"["+sr(g,p)+"]":"[ "+q.call(g,", ")+" ]"}if(Ys(e)){var V=pt(e,u);return!("cause"in Error.prototype)&&"cause"in e&&!pi.call(e,"cause")?"{ ["+String(e)+"] "+q.call(ni.call("[cause]: "+u(e.cause),V),", ")+" }":V.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+q.call(V,", ")+" }"}if(typeof e=="object"&&s){if(li&&typeof e[li]=="function"&&ir)return ir(e,{depth:f-n});if(s!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(na(e)){var ee=[];return Zn&&Zn.call(e,function(L,J){ee.push(u(J,e,!0)+" => "+u(L,e))}),ui("Map",ht.call(e),ee,p)}if(sa(e)){var Pe=[];return ei&&ei.call(e,function(L){Pe.push(u(L,e))}),ui("Set",dt.call(e),Pe,p)}if(ia(e))return tr("WeakMap");if(aa(e))return tr("WeakSet");if(oa(e))return tr("WeakRef");if(Qs(e))return Le(u(Number(e)));if(ea(e))return Le(u(rr.call(e)));if(Zs(e))return Le(Hs.call(e));if(js(e))return Le(u(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===global)return"{ [object globalThis] }";if(!Xs(e)&&!ci(e)){var pe=pt(e,u),tt=oi?oi(e)===Object.prototype:e instanceof Object||e.constructor===Object,te=e instanceof Object?"":"null prototype",K=!tt&&k&&Object(e)===e&&k in e?cr.call(Q(e),8,-1):te?"Object":"",rt=tt||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",he=rt+(K||te?"["+q.call(ni.call([],K||[],te||[]),": ")+"] ":"");return pe.length===0?he+"{}":p?he+"{"+sr(pe,p)+"}":he+"{ "+q.call(pe,", ")+" }"}return String(e)};function hi(t,e,r){var n=(r.quoteStyle||e)==="double"?'"':"'";return n+t+n}function Js(t){return j.call(String(t),/"/g,"&quot;")}function or(t){return Q(t)==="[object Array]"&&(!k||!(typeof t=="object"&&k in t))}function Xs(t){return Q(t)==="[object Date]"&&(!k||!(typeof t=="object"&&k in t))}function ci(t){return Q(t)==="[object RegExp]"&&(!k||!(typeof t=="object"&&k in t))}function Ys(t){return Q(t)==="[object Error]"&&(!k||!(typeof t=="object"&&k in t))}function js(t){return Q(t)==="[object String]"&&(!k||!(typeof t=="object"&&k in t))}function Qs(t){return Q(t)==="[object Number]"&&(!k||!(typeof t=="object"&&k in t))}function Zs(t){return Q(t)==="[object Boolean]"&&(!k||!(typeof t=="object"&&k in t))}function di(t){if(Se)return t&&typeof t=="object"&&t instanceof Symbol;if(typeof t=="symbol")return!0;if(!t||typeof t!="object"||!nr)return!1;try{return nr.call(t),!0}catch{}return!1}function ea(t){if(!t||typeof t!="object"||!rr)return!1;try{return rr.call(t),!0}catch{}return!1}var ta=Object.prototype.hasOwnProperty||function(t){return t in this};function Y(t,e){return ta.call(t,e)}function Q(t){return zs.call(t)}function ra(t){if(t.name)return t.name;var e=Gs.call(Ws.call(t),/^function\s*([\w$]+)/);return e?e[1]:null}function yi(t,e){if(t.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function na(t){if(!ht||!t||typeof t!="object")return!1;try{ht.call(t);try{dt.call(t)}catch{return!0}return t instanceof Map}catch{}return!1}function ia(t){if(!Be||!t||typeof t!="object")return!1;try{Be.call(t,Be);try{qe.call(t,qe)}catch{return!0}return t instanceof WeakMap}catch{}return!1}function oa(t){if(!ti||!t||typeof t!="object")return!1;try{return ti.call(t),!0}catch{}return!1}function sa(t){if(!dt||!t||typeof t!="object")return!1;try{dt.call(t);try{ht.call(t)}catch{return!0}return t instanceof Set}catch{}return!1}function aa(t){if(!qe||!t||typeof t!="object")return!1;try{qe.call(t,qe);try{Be.call(t,Be)}catch{return!0}return t instanceof WeakSet}catch{}return!1}function la(t){return!t||typeof t!="object"?!1:typeof HTMLElement<"u"&&t instanceof HTMLElement?!0:typeof t.nodeName=="string"&&typeof t.getAttribute=="function"}function mi(t,e){if(t.length>e.maxStringLength){var r=t.length-e.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return mi(cr.call(t,0,e.maxStringLength),e)+n}var o=j.call(j.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,ca);return hi(o,"single",e)}function ca(t){var e=t.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return r?"\\"+r:"\\x"+(e<16?"0":"")+Vs.call(e.toString(16))}function Le(t){return"Object("+t+")"}function tr(t){return t+" { ? }"}function ui(t,e,r,n){var o=n?sr(r,n):q.call(r,", ");return t+" ("+e+") {"+o+"}"}function ua(t){for(var e=0;e<t.length;e++)if(yi(t[e],`
`)>=0)return!1;return!0}function fa(t,e){var r;if(t.indent==="	")r="	";else if(typeof t.indent=="number"&&t.indent>0)r=q.call(Array(t.indent+1)," ");else return null;return{base:r,prev:q.call(Array(e+1),r)}}function sr(t,e){if(t.length===0)return"";var r=`
`+e.prev+e.base;return r+q.call(t,","+r)+`
`+e.prev}function pt(t,e){var r=or(t),n=[];if(r){n.length=t.length;for(var o=0;o<t.length;o++)n[o]=Y(t,o)?e(t[o],t):""}var i=typeof er=="function"?er(t):[],s;if(Se){s={};for(var a=0;a<i.length;a++)s["$"+i[a]]=i[a]}for(var l in t)Y(t,l)&&(r&&String(Number(l))===l&&l<t.length||Se&&s["$"+l]instanceof Symbol||(fi.call(/[^\w$]/,l)?n.push(e(l,t)+": "+e(t[l],t)):n.push(l+": "+e(t[l],t))));if(typeof er=="function")for(var c=0;c<i.length;c++)pi.call(t,i[c])&&n.push("["+e(i[c])+"]: "+e(t[i[c]],t));return n}});var Si=h((wc,vi)=>{"use strict";var bi=se(),Ee=jn(),pa=wi(),ha=ye(),yt=bi("%WeakMap%",!0),mt=bi("%Map%",!0),da=Ee("WeakMap.prototype.get",!0),ya=Ee("WeakMap.prototype.set",!0),ma=Ee("WeakMap.prototype.has",!0),ga=Ee("Map.prototype.get",!0),wa=Ee("Map.prototype.set",!0),ba=Ee("Map.prototype.has",!0),ur=function(t,e){for(var r=t,n;(n=r.next)!==null;r=n)if(n.key===e)return r.next=n.next,n.next=t.next,t.next=n,n},va=function(t,e){var r=ur(t,e);return r&&r.value},Sa=function(t,e,r){var n=ur(t,e);n?n.value=r:t.next={key:e,next:t.next,value:r}},Ea=function(t,e){return!!ur(t,e)};vi.exports=function(){var e,r,n,o={assert:function(i){if(!o.has(i))throw new ha("Side channel does not contain "+pa(i))},get:function(i){if(yt&&i&&(typeof i=="object"||typeof i=="function")){if(e)return da(e,i)}else if(mt){if(r)return ga(r,i)}else if(n)return va(n,i)},has:function(i){if(yt&&i&&(typeof i=="object"||typeof i=="function")){if(e)return ma(e,i)}else if(mt){if(r)return ba(r,i)}else if(n)return Ea(n,i);return!1},set:function(i,s){yt&&i&&(typeof i=="object"||typeof i=="function")?(e||(e=new yt),ya(e,i,s)):mt?(r||(r=new mt),wa(r,i,s)):(n||(n={key:{},next:null}),Sa(n,i,s))}};return o}});var gt=h((bc,Ei)=>{"use strict";var _a=String.prototype.replace,Aa=/%20/g,fr={RFC1738:"RFC1738",RFC3986:"RFC3986"};Ei.exports={default:fr.RFC3986,formatters:{RFC1738:function(t){return _a.call(t,Aa,"+")},RFC3986:function(t){return String(t)}},RFC1738:fr.RFC1738,RFC3986:fr.RFC3986}});var dr=h((vc,Ai)=>{"use strict";var xa=gt(),pr=Object.prototype.hasOwnProperty,ae=Array.isArray,F=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),Ta=function(e){for(;e.length>1;){var r=e.pop(),n=r.obj[r.prop];if(ae(n)){for(var o=[],i=0;i<n.length;++i)typeof n[i]<"u"&&o.push(n[i]);r.obj[r.prop]=o}}},_i=function(e,r){for(var n=r&&r.plainObjects?Object.create(null):{},o=0;o<e.length;++o)typeof e[o]<"u"&&(n[o]=e[o]);return n},Oa=function t(e,r,n){if(!r)return e;if(typeof r!="object"){if(ae(e))e.push(r);else if(e&&typeof e=="object")(n&&(n.plainObjects||n.allowPrototypes)||!pr.call(Object.prototype,r))&&(e[r]=!0);else return[e,r];return e}if(!e||typeof e!="object")return[e].concat(r);var o=e;return ae(e)&&!ae(r)&&(o=_i(e,n)),ae(e)&&ae(r)?(r.forEach(function(i,s){if(pr.call(e,s)){var a=e[s];a&&typeof a=="object"&&i&&typeof i=="object"?e[s]=t(a,i,n):e.push(i)}else e[s]=i}),e):Object.keys(r).reduce(function(i,s){var a=r[s];return pr.call(i,s)?i[s]=t(i[s],a,n):i[s]=a,i},o)},ka=function(e,r){return Object.keys(r).reduce(function(n,o){return n[o]=r[o],n},e)},Ra=function(t,e,r){var n=t.replace(/\+/g," ");if(r==="iso-8859-1")return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch{return n}},hr=1024,Ca=function(e,r,n,o,i){if(e.length===0)return e;var s=e;if(typeof e=="symbol"?s=Symbol.prototype.toString.call(e):typeof e!="string"&&(s=String(e)),n==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(m){return"%26%23"+parseInt(m.slice(2),16)+"%3B"});for(var a="",l=0;l<s.length;l+=hr){for(var c=s.length>=hr?s.slice(l,l+hr):s,f=[],p=0;p<c.length;++p){var u=c.charCodeAt(p);if(u===45||u===46||u===95||u===126||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||i===xa.RFC1738&&(u===40||u===41)){f[f.length]=c.charAt(p);continue}if(u<128){f[f.length]=F[u];continue}if(u<2048){f[f.length]=F[192|u>>6]+F[128|u&63];continue}if(u<55296||u>=57344){f[f.length]=F[224|u>>12]+F[128|u>>6&63]+F[128|u&63];continue}p+=1,u=65536+((u&1023)<<10|c.charCodeAt(p)&1023),f[f.length]=F[240|u>>18]+F[128|u>>12&63]+F[128|u>>6&63]+F[128|u&63]}a+=f.join("")}return a},Pa=function(e){for(var r=[{obj:{o:e},prop:"o"}],n=[],o=0;o<r.length;++o)for(var i=r[o],s=i.obj[i.prop],a=Object.keys(s),l=0;l<a.length;++l){var c=a[l],f=s[c];typeof f=="object"&&f!==null&&n.indexOf(f)===-1&&(r.push({obj:s,prop:c}),n.push(f))}return Ta(r),e},$a=function(e){return Object.prototype.toString.call(e)==="[object RegExp]"},Da=function(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},Ia=function(e,r){return[].concat(e,r)},Na=function(e,r){if(ae(e)){for(var n=[],o=0;o<e.length;o+=1)n.push(r(e[o]));return n}return r(e)};Ai.exports={arrayToObject:_i,assign:ka,combine:Ia,compact:Pa,decode:Ra,encode:Ca,isBuffer:Da,isRegExp:$a,maybeMap:Na,merge:Oa}});var Ci=h((Sc,Ri)=>{"use strict";var Ti=Si(),wt=dr(),Fe=gt(),La=Object.prototype.hasOwnProperty,Oi={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},M=Array.isArray,Ba=Array.prototype.push,ki=function(t,e){Ba.apply(t,M(e)?e:[e])},qa=Date.prototype.toISOString,xi=Fe.default,A={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:wt.encode,encodeValuesOnly:!1,format:xi,formatter:Fe.formatters[xi],indices:!1,serializeDate:function(e){return qa.call(e)},skipNulls:!1,strictNullHandling:!1},Fa=function(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"},yr={},Ma=function t(e,r,n,o,i,s,a,l,c,f,p,u,m,v,x,P,D,G){for(var g=e,V=G,ee=0,Pe=!1;(V=V.get(yr))!==void 0&&!Pe;){var pe=V.get(e);if(ee+=1,typeof pe<"u"){if(pe===ee)throw new RangeError("Cyclic object value");Pe=!0}typeof V.get(yr)>"u"&&(ee=0)}if(typeof f=="function"?g=f(r,g):g instanceof Date?g=m(g):n==="comma"&&M(g)&&(g=wt.maybeMap(g,function(Mt){return Mt instanceof Date?m(Mt):Mt})),g===null){if(s)return c&&!P?c(r,A.encoder,D,"key",v):r;g=""}if(Fa(g)||wt.isBuffer(g)){if(c){var tt=P?r:c(r,A.encoder,D,"key",v);return[x(tt)+"="+x(c(g,A.encoder,D,"value",v))]}return[x(r)+"="+x(String(g))]}var te=[];if(typeof g>"u")return te;var K;if(n==="comma"&&M(g))P&&c&&(g=wt.maybeMap(g,c)),K=[{value:g.length>0?g.join(",")||null:void 0}];else if(M(f))K=f;else{var rt=Object.keys(g);K=p?rt.sort(p):rt}var he=l?r.replace(/\./g,"%2E"):r,L=o&&M(g)&&g.length===1?he+"[]":he;if(i&&M(g)&&g.length===0)return L+"[]";for(var J=0;J<K.length;++J){var X=K[J],$e=typeof X=="object"&&typeof X.value<"u"?X.value:g[X];if(!(a&&$e===null)){var Ft=u&&l?X.replace(/\./g,"%2E"):X,Vo=M(g)?typeof n=="function"?n(L,Ft):L:L+(u?"."+Ft:"["+Ft+"]");G.set(e,ee);var Hr=Ti();Hr.set(yr,G),ki(te,t($e,Vo,n,o,i,s,a,l,n==="comma"&&P&&M(g)?null:c,f,p,u,m,v,x,P,D,Hr))}}return te},Ua=function(e){if(!e)return A;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");var r=e.charset||A.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=Fe.default;if(typeof e.format<"u"){if(!La.call(Fe.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var o=Fe.formatters[n],i=A.filter;(typeof e.filter=="function"||M(e.filter))&&(i=e.filter);var s;if(e.arrayFormat in Oi?s=e.arrayFormat:"indices"in e?s=e.indices?"indices":"repeat":s=A.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var a=typeof e.allowDots>"u"?e.encodeDotInKeys===!0?!0:A.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:A.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:A.allowEmptyArrays,arrayFormat:s,charset:r,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:A.charsetSentinel,commaRoundTrip:e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?A.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:A.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:A.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:A.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:A.encodeValuesOnly,filter:i,format:n,formatter:o,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:A.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:A.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:A.strictNullHandling}};Ri.exports=function(t,e){var r=t,n=Ua(e),o,i;typeof n.filter=="function"?(i=n.filter,r=i("",r)):M(n.filter)&&(i=n.filter,o=i);var s=[];if(typeof r!="object"||r===null)return"";var a=Oi[n.arrayFormat],l=a==="comma"&&n.commaRoundTrip;o||(o=Object.keys(r)),n.sort&&o.sort(n.sort);for(var c=Ti(),f=0;f<o.length;++f){var p=o[f];n.skipNulls&&r[p]===null||ki(s,Ma(r[p],p,a,l,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,c))}var u=s.join(n.delimiter),m=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?m+="utf8=%26%2310003%3B&":m+="utf8=%E2%9C%93&"),u.length>0?m+u:""}});var Di=h((Ec,$i)=>{"use strict";var _e=dr(),mr=Object.prototype.hasOwnProperty,Ha=Array.isArray,_={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:_e.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},za=function(t){return t.replace(/&#(\d+);/g,function(e,r){return String.fromCharCode(parseInt(r,10))})},Pi=function(t,e){return t&&typeof t=="string"&&e.comma&&t.indexOf(",")>-1?t.split(","):t},Wa="utf8=%26%2310003%3B",Ga="utf8=%E2%9C%93",Va=function(e,r){var n={__proto__:null},o=r.ignoreQueryPrefix?e.replace(/^\?/,""):e,i=r.parameterLimit===1/0?void 0:r.parameterLimit,s=o.split(r.delimiter,i),a=-1,l,c=r.charset;if(r.charsetSentinel)for(l=0;l<s.length;++l)s[l].indexOf("utf8=")===0&&(s[l]===Ga?c="utf-8":s[l]===Wa&&(c="iso-8859-1"),a=l,l=s.length);for(l=0;l<s.length;++l)if(l!==a){var f=s[l],p=f.indexOf("]="),u=p===-1?f.indexOf("="):p+1,m,v;u===-1?(m=r.decoder(f,_.decoder,c,"key"),v=r.strictNullHandling?null:""):(m=r.decoder(f.slice(0,u),_.decoder,c,"key"),v=_e.maybeMap(Pi(f.slice(u+1),r),function(P){return r.decoder(P,_.decoder,c,"value")})),v&&r.interpretNumericEntities&&c==="iso-8859-1"&&(v=za(v)),f.indexOf("[]=")>-1&&(v=Ha(v)?[v]:v);var x=mr.call(n,m);x&&r.duplicates==="combine"?n[m]=_e.combine(n[m],v):(!x||r.duplicates==="last")&&(n[m]=v)}return n},Ka=function(t,e,r,n){for(var o=n?e:Pi(e,r),i=t.length-1;i>=0;--i){var s,a=t[i];if(a==="[]"&&r.parseArrays)s=r.allowEmptyArrays&&o===""?[]:[].concat(o);else{s=r.plainObjects?Object.create(null):{};var l=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a,c=r.decodeDotInKeys?l.replace(/%2E/g,"."):l,f=parseInt(c,10);!r.parseArrays&&c===""?s={0:o}:!isNaN(f)&&a!==c&&String(f)===c&&f>=0&&r.parseArrays&&f<=r.arrayLimit?(s=[],s[f]=o):c!=="__proto__"&&(s[c]=o)}o=s}return o},Ja=function(e,r,n,o){if(e){var i=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,s=/(\[[^[\]]*])/,a=/(\[[^[\]]*])/g,l=n.depth>0&&s.exec(i),c=l?i.slice(0,l.index):i,f=[];if(c){if(!n.plainObjects&&mr.call(Object.prototype,c)&&!n.allowPrototypes)return;f.push(c)}for(var p=0;n.depth>0&&(l=a.exec(i))!==null&&p<n.depth;){if(p+=1,!n.plainObjects&&mr.call(Object.prototype,l[1].slice(1,-1))&&!n.allowPrototypes)return;f.push(l[1])}return l&&f.push("["+i.slice(l.index)+"]"),Ka(f,r,n,o)}},Xa=function(e){if(!e)return _;if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.decodeDotInKeys<"u"&&typeof e.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(e.decoder!==null&&typeof e.decoder<"u"&&typeof e.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=typeof e.charset>"u"?_.charset:e.charset,n=typeof e.duplicates>"u"?_.duplicates:e.duplicates;if(n!=="combine"&&n!=="first"&&n!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var o=typeof e.allowDots>"u"?e.decodeDotInKeys===!0?!0:_.allowDots:!!e.allowDots;return{allowDots:o,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:_.allowEmptyArrays,allowPrototypes:typeof e.allowPrototypes=="boolean"?e.allowPrototypes:_.allowPrototypes,allowSparse:typeof e.allowSparse=="boolean"?e.allowSparse:_.allowSparse,arrayLimit:typeof e.arrayLimit=="number"?e.arrayLimit:_.arrayLimit,charset:r,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:_.charsetSentinel,comma:typeof e.comma=="boolean"?e.comma:_.comma,decodeDotInKeys:typeof e.decodeDotInKeys=="boolean"?e.decodeDotInKeys:_.decodeDotInKeys,decoder:typeof e.decoder=="function"?e.decoder:_.decoder,delimiter:typeof e.delimiter=="string"||_e.isRegExp(e.delimiter)?e.delimiter:_.delimiter,depth:typeof e.depth=="number"||e.depth===!1?+e.depth:_.depth,duplicates:n,ignoreQueryPrefix:e.ignoreQueryPrefix===!0,interpretNumericEntities:typeof e.interpretNumericEntities=="boolean"?e.interpretNumericEntities:_.interpretNumericEntities,parameterLimit:typeof e.parameterLimit=="number"?e.parameterLimit:_.parameterLimit,parseArrays:e.parseArrays!==!1,plainObjects:typeof e.plainObjects=="boolean"?e.plainObjects:_.plainObjects,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:_.strictNullHandling}};$i.exports=function(t,e){var r=Xa(e);if(t===""||t===null||typeof t>"u")return r.plainObjects?Object.create(null):{};for(var n=typeof t=="string"?Va(t,r):t,o=r.plainObjects?Object.create(null):{},i=Object.keys(n),s=0;s<i.length;++s){var a=i[s],l=Ja(a,n[a],r,typeof t=="string");o=_e.merge(o,l,r)}return r.allowSparse===!0?o:_e.compact(o)}});var Ni=h((_c,Ii)=>{"use strict";var Ya=Ci(),ja=Di(),Qa=gt();Ii.exports={formats:Qa,parse:ja,stringify:Ya}});var Li=h(()=>{});var bt=h(U=>{"use strict";function qi(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Za(t))||e&&t&&typeof t.length=="number"){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,a;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return i=c.done,c},e:function(c){s=!0,a=c},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw a}}}}function Za(t,e){if(t){if(typeof t=="string")return Bi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bi(t,e)}}function Bi(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}U.type=t=>t.split(/ *; */).shift();U.params=t=>{let e={};var r=qi(t.split(/ *; */)),n;try{for(r.s();!(n=r.n()).done;){let i=n.value.split(/ *= */),s=i.shift(),a=i.shift();s&&a&&(e[s]=a)}}catch(o){r.e(o)}finally{r.f()}return e};U.parseLinks=t=>{let e={};var r=qi(t.split(/ *, */)),n;try{for(r.s();!(n=r.n()).done;){let i=n.value.split(/ *; */),s=i[0].slice(1,-1),a=i[1].split(/ *= */)[1].slice(1,-1);e[a]=s}}catch(o){r.e(o)}finally{r.f()}return e};U.cleanHeader=(t,e)=>(delete t["content-type"],delete t["content-length"],delete t["transfer-encoding"],delete t.host,e&&(delete t.authorization,delete t.cookie),t);U.isObject=t=>t!==null&&typeof t=="object";U.hasOwn=Object.hasOwn||function(t,e){if(t==null)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(new Object(t),e)};U.mixin=(t,e)=>{for(let r in e)U.hasOwn(e,r)&&(t[r]=e[r])}});var Hi=h((Oc,Ui)=>{"use strict";var Fi=Li(),Mi=bt(),vt=Mi.isObject,Me=Mi.hasOwn;Ui.exports=w;function w(){}w.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),clearTimeout(this._uploadTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,delete this._uploadTimeoutTimer,this};w.prototype.parse=function(t){return this._parser=t,this};w.prototype.responseType=function(t){return this._responseType=t,this};w.prototype.serialize=function(t){return this._serializer=t,this};w.prototype.timeout=function(t){if(!t||typeof t!="object")return this._timeout=t,this._responseTimeout=0,this._uploadTimeout=0,this;for(let e in t)if(Me(t,e))switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;case"upload":this._uploadTimeout=t.upload;break;default:console.warn("Unknown timeout option",e)}return this};w.prototype.retry=function(t,e){return(arguments.length===0||t===!0)&&(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var el=new Set(["ETIMEDOUT","ECONNRESET","EADDRINUSE","ECONNREFUSED","EPIPE","ENOTFOUND","ENETUNREACH","EAI_AGAIN"]),tl=new Set([408,413,429,500,502,503,504,521,522,524]);w.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{let r=this._retryCallback(t,e);if(r===!0)return!0;if(r===!1)return!1}catch(r){console.error(r)}return!!(e&&e.status&&tl.has(e.status)||t&&(t.code&&el.has(t.code)||t.timeout&&t.code==="ECONNABORTED"||t.crossDomain))};w.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this.timedoutError=null,this._end()};w.prototype.then=function(t,e){if(!this._fullfilledPromise){let r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((n,o)=>{r.on("abort",()=>{if(this._maxRetries&&this._maxRetries>this._retries)return;if(this.timedout&&this.timedoutError){o(this.timedoutError);return}let i=new Error("Aborted");i.code="ABORTED",i.status=this.status,i.method=this.method,i.url=this.url,o(i)}),r.end((i,s)=>{i?o(i):n(s)})})}return this._fullfilledPromise.then(t,e)};w.prototype.catch=function(t){return this.then(void 0,t)};w.prototype.use=function(t){return t(this),this};w.prototype.ok=function(t){if(typeof t!="function")throw new Error("Callback required");return this._okCallback=t,this};w.prototype._isResponseOK=function(t){return t?this._okCallback?this._okCallback(t):t.status>=200&&t.status<300:!1};w.prototype.get=function(t){return this._header[t.toLowerCase()]};w.prototype.getHeader=w.prototype.get;w.prototype.set=function(t,e){if(vt(t)){for(let r in t)Me(t,r)&&this.set(r,t[r]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this};w.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this};w.prototype.field=function(t,e,r){if(t==null)throw new Error(".field(name, val) name can not be empty");if(this._data)throw new Error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()");if(vt(t)){for(let n in t)Me(t,n)&&this.field(n,t[n]);return this}if(Array.isArray(e)){for(let n in e)Me(e,n)&&this.field(t,e[n]);return this}if(e==null)throw new Error(".field(name, val) val can not be empty");return typeof e=="boolean"&&(e=String(e)),r?this._getFormData().append(t,e,r):this._getFormData().append(t,e),this};w.prototype.abort=function(){if(this._aborted)return this;if(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req){if(Fi.gte(process.version,"v13.0.0")&&Fi.lt(process.version,"v14.0.0"))throw new Error("Superagent does not work in v13 properly with abort() due to Node.js core changes");this.req.abort()}return this.clearTimeout(),this.emit("abort"),this};w.prototype._auth=function(t,e,r,n){switch(r.type){case"basic":this.set("Authorization",`Basic ${n(`${t}:${e}`)}`);break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization",`Bearer ${t}`);break;default:break}return this};w.prototype.withCredentials=function(t){return t===void 0&&(t=!0),this._withCredentials=t,this};w.prototype.redirects=function(t){return this._maxRedirects=t,this};w.prototype.maxResponseSize=function(t){if(typeof t!="number")throw new TypeError("Invalid argument");return this._maxResponseSize=t,this};w.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}};w.prototype.send=function(t){let e=vt(t),r=this._header["content-type"];if(this._formData)throw new Error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()");if(e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw new Error("Can't merge these send calls");if(e&&vt(this._data))for(let n in t){if(typeof t[n]=="bigint"&&!t[n].toJSON)throw new Error("Cannot serialize BigInt value to json");Me(t,n)&&(this._data[n]=t[n])}else{if(typeof t=="bigint")throw new Error("Cannot send value of type BigInt");typeof t=="string"?(r||this.type("form"),r=this._header["content-type"],r&&(r=r.toLowerCase().trim()),r==="application/x-www-form-urlencoded"?this._data=this._data?`${this._data}&${t}`:t:this._data=(this._data||"")+t):this._data=t}return!e||this._isHost(t)?this:(r||this.type("json"),this)};w.prototype.sortQuery=function(t){return this._sort=typeof t>"u"?!0:t,this};w.prototype._finalizeQueryString=function(){let t=this._query.join("&");if(t&&(this.url+=(this.url.includes("?")?"&":"?")+t),this._query.length=0,this._sort){let e=this.url.indexOf("?");if(e>=0){let r=this.url.slice(e+1).split("&");typeof this._sort=="function"?r.sort(this._sort):r.sort(),this.url=this.url.slice(0,e)+"?"+r.join("&")}}};w.prototype._appendQueryString=()=>{console.warn("Unsupported")};w.prototype._timeoutError=function(t,e,r){if(this._aborted)return;let n=new Error(`${t+e}ms exceeded`);n.timeout=e,n.code="ECONNABORTED",n.errno=r,this.timedout=!0,this.timedoutError=n,this.abort(),this.callback(n)};w.prototype._setTimeouts=function(){let t=this;this._timeout&&!this._timer&&(this._timer=setTimeout(()=>{t._timeoutError("Timeout of ",t._timeout,"ETIME")},this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout(()=>{t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")},this._responseTimeout))}});var Wi=h((kc,zi)=>{"use strict";var gr=bt();zi.exports=St;function St(){}St.prototype.get=function(t){return this.header[t.toLowerCase()]};St.prototype._setHeaderProperties=function(t){let e=t["content-type"]||"";this.type=gr.type(e);let r=gr.params(e);for(let n in r)Object.prototype.hasOwnProperty.call(r,n)&&(this[n]=r[n]);this.links={};try{t.link&&(this.links=gr.parseLinks(t.link))}catch{}};St.prototype._setStatusProperties=function(t){let e=Math.trunc(t/100);this.statusCode=t,this.status=this.statusCode,this.statusType=e,this.info=e===1,this.ok=e===2,this.redirect=e===3,this.clientError=e===4,this.serverError=e===5,this.error=e===4||e===5?this.toError():!1,this.created=t===201,this.accepted=t===202,this.noContent=t===204,this.badRequest=t===400,this.unauthorized=t===401,this.notAcceptable=t===406,this.forbidden=t===403,this.notFound=t===404,this.unprocessableEntity=t===422}});var Ki=h((Rc,Vi)=>{"use strict";function rl(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=nl(t))||e&&t&&typeof t.length=="number"){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,a;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return i=c.done,c},e:function(c){s=!0,a=c},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw a}}}}function nl(t,e){if(t){if(typeof t=="string")return Gi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gi(t,e)}}function Gi(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function br(){this._defaults=[]}for(Et=0,wr=["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert","disableTLSCerts"];Et<wr.length;Et++){let t=wr[Et];br.prototype[t]=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return this._defaults.push({fn:t,args:r}),this}}var Et,wr;br.prototype._setDefaults=function(t){var e=rl(this._defaults),r;try{for(e.s();!(r=e.n()).done;){let n=r.value;t[n.fn](...n.args)}}catch(n){e.e(n)}finally{e.f()}};Vi.exports=br});var xe=h((le,Ar)=>{"use strict";function il(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=ol(t))||e&&t&&typeof t.length=="number"){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var i=!0,s=!1,a;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return i=c.done,c},e:function(c){s=!0,a=c},f:function(){try{!i&&r.return!=null&&r.return()}finally{if(s)throw a}}}}function ol(t,e){if(t){if(typeof t=="string")return Ji(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ji(t,e)}}function Ji(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Ae;typeof window<"u"?Ae=window:typeof self>"u"?(console.warn("Using browser-only version of superagent in non-browser environment"),Ae=void 0):Ae=self;var sl=Wr(),al=Yr(),ll=Ni(),cl=Hi(),Er=bt(),Xi=Er.isObject,Yi=Er.mixin,_r=Er.hasOwn,ul=Wi(),At=Ki();function fl(){}Ar.exports=function(t,e){return typeof e=="function"?new le.Request("GET",t).end(e):arguments.length===1?new le.Request("GET",t):new le.Request(t,e)};le=Ar.exports;var b=le;le.Request=E;b.getXHR=()=>{if(Ae.XMLHttpRequest)return new Ae.XMLHttpRequest;throw new Error("Browser-only version of superagent could not find XHR")};var pl="".trim?t=>t.trim():t=>t.replace(/(^\s*|\s*$)/g,"");function ji(t){if(!Xi(t))return t;let e=[];for(let r in t)_r(t,r)&&Sr(e,r,t[r]);return e.join("&")}function Sr(t,e,r){if(r!==void 0){if(r===null){t.push(encodeURI(e));return}if(Array.isArray(r)){var n=il(r),o;try{for(n.s();!(o=n.n()).done;){let i=o.value;Sr(t,e,i)}}catch(i){n.e(i)}finally{n.f()}}else if(Xi(r))for(let i in r)_r(r,i)&&Sr(t,`${e}[${i}]`,r[i]);else t.push(encodeURI(e)+"="+encodeURIComponent(r))}}b.serializeObject=ji;function Qi(t){let e={},r=t.split("&"),n,o;for(let i=0,s=r.length;i<s;++i)n=r[i],o=n.indexOf("="),o===-1?e[decodeURIComponent(n)]="":e[decodeURIComponent(n.slice(0,o))]=decodeURIComponent(n.slice(o+1));return e}b.parseString=Qi;b.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};b.serialize={"application/x-www-form-urlencoded":ll.stringify,"application/json":al};b.parse={"application/x-www-form-urlencoded":Qi,"application/json":JSON.parse};function hl(t){let e=t.split(/\r?\n/),r={},n,o,i,s;for(let a=0,l=e.length;a<l;++a)o=e[a],n=o.indexOf(":"),n!==-1&&(i=o.slice(0,n).toLowerCase(),s=pl(o.slice(n+1)),r[i]=s);return r}function Zi(t){return/[/+]json($|[^-\w])/i.test(t)}function Ue(t){this.req=t,this.xhr=this.req.xhr,this.text=this.req.method!=="HEAD"&&(this.xhr.responseType===""||this.xhr.responseType==="text")||typeof this.xhr.responseType>"u"?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;let e=this.xhr.status;e===1223&&(e=204),this._setStatusProperties(e),this.headers=hl(this.xhr.getAllResponseHeaders()),this.header=this.headers,this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),this.text===null&&t._responseType?this.body=this.xhr.response:this.body=this.req.method==="HEAD"?null:this._parseBody(this.text?this.text:this.xhr.response)}Yi(Ue.prototype,ul.prototype);Ue.prototype._parseBody=function(t){let e=b.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&Zi(this.type)&&(e=b.parse["application/json"]),e&&t&&(t.length>0||t instanceof Object)?e(t):null)};Ue.prototype.toError=function(){let t=this.req,e=t.method,r=t.url,n=`cannot ${e} ${r} (${this.status})`,o=new Error(n);return o.status=this.status,o.method=e,o.url=r,o};b.Response=Ue;function E(t,e){let r=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",()=>{let n=null,o=null;try{o=new Ue(r)}catch(s){return n=new Error("Parser is unable to parse the response"),n.parse=!0,n.original=s,r.xhr?(n.rawResponse=typeof r.xhr.responseType>"u"?r.xhr.responseText:r.xhr.response,n.status=r.xhr.status?r.xhr.status:null,n.statusCode=n.status):(n.rawResponse=null,n.status=null),r.callback(n)}r.emit("response",o);let i;try{r._isResponseOK(o)||(i=new Error(o.statusText||o.text||"Unsuccessful HTTP response"))}catch(s){i=s}i?(i.original=n,i.response=o,i.status=i.status||o.status,r.callback(i,o)):r.callback(null,o)})}sl(E.prototype);Yi(E.prototype,cl.prototype);E.prototype.type=function(t){return this.set("Content-Type",b.types[t]||t),this};E.prototype.accept=function(t){return this.set("Accept",b.types[t]||t),this};E.prototype.auth=function(t,e,r){arguments.length===1&&(e=""),typeof e=="object"&&e!==null&&(r=e,e=""),r||(r={type:typeof btoa=="function"?"basic":"auto"});let n=r.encoder?r.encoder:o=>{if(typeof btoa=="function")return btoa(o);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,r,n)};E.prototype.query=function(t){return typeof t!="string"&&(t=ji(t)),t&&this._query.push(t),this};E.prototype.attach=function(t,e,r){if(e){if(this._data)throw new Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,r||e.name)}return this};E.prototype._getFormData=function(){return this._formData||(this._formData=new Ae.FormData),this._formData};E.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();let r=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),r(t,e)};E.prototype.crossDomainError=function(){let t=new Error(`Request has been terminated
Possible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.`);t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)};E.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this};E.prototype.ca=E.prototype.agent;E.prototype.buffer=E.prototype.ca;E.prototype.write=()=>{throw new Error("Streaming is not supported in browser version of superagent")};E.prototype.pipe=E.prototype.write;E.prototype._isHost=function(t){return t&&typeof t=="object"&&!Array.isArray(t)&&Object.prototype.toString.call(t)!=="[object Object]"};E.prototype.end=function(t){this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||fl,this._finalizeQueryString(),this._end()};E.prototype._setUploadTimeout=function(){let t=this;this._uploadTimeout&&!this._uploadTimeoutTimer&&(this._uploadTimeoutTimer=setTimeout(()=>{t._timeoutError("Upload timeout of ",t._uploadTimeout,"ETIMEDOUT")},this._uploadTimeout))};E.prototype._end=function(){if(this._aborted)return this.callback(new Error("The request has been aborted even before .end() was called"));let t=this;this.xhr=b.getXHR();let e=this.xhr,r=this._formData||this._data;this._setTimeouts(),e.addEventListener("readystatechange",()=>{let o=e.readyState;if(o>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),o!==4)return;let i;try{i=e.status}catch{i=0}if(!i)return t.timedout||t._aborted?void 0:t.crossDomainError();t.emit("end")});let n=(o,i)=>{i.total>0&&(i.percent=i.loaded/i.total*100,i.percent===100&&clearTimeout(t._uploadTimeoutTimer)),i.direction=o,t.emit("progress",i)};if(this.hasListeners("progress"))try{e.addEventListener("progress",n.bind(null,"download")),e.upload&&e.upload.addEventListener("progress",n.bind(null,"upload"))}catch{}e.upload&&this._setUploadTimeout();try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(o){return this.callback(o)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&this.method!=="GET"&&this.method!=="HEAD"&&typeof r!="string"&&!this._isHost(r)){let o=this._header["content-type"],i=this._serializer||b.serialize[o?o.split(";")[0]:""];!i&&Zi(o)&&(i=b.serialize["application/json"]),i&&(r=i(r))}for(let o in this.header)this.header[o]!==null&&_r(this.header,o)&&e.setRequestHeader(o,this.header[o]);this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(typeof r>"u"?null:r)};b.agent=()=>new At;for(_t=0,vr=["GET","POST","OPTIONS","PATCH","PUT","DELETE"];_t<vr.length;_t++){let t=vr[_t];At.prototype[t.toLowerCase()]=function(e,r){let n=new b.Request(t,e);return this._setDefaults(n),r&&n.end(r),n}}var _t,vr;At.prototype.del=At.prototype.delete;b.get=(t,e,r)=>{let n=b("GET",t);return typeof e=="function"&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n};b.head=(t,e,r)=>{let n=b("HEAD",t);return typeof e=="function"&&(r=e,e=null),e&&n.query(e),r&&n.end(r),n};b.options=(t,e,r)=>{let n=b("OPTIONS",t);return typeof e=="function"&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n};function eo(t,e,r){let n=b("DELETE",t);return typeof e=="function"&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}b.del=eo;b.delete=eo;b.patch=(t,e,r)=>{let n=b("PATCH",t);return typeof e=="function"&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n};b.post=(t,e,r)=>{let n=b("POST",t);return typeof e=="function"&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n};b.put=(t,e,r)=>{let n=b("PUT",t);return typeof e=="function"&&(r=e,e=null),e&&n.send(e),r&&n.end(r),n}});var Tr=De(xe());var io=De(xe());function R(t){window.location.pathname=`${window.site_prefix}${t}`}function H(){return window.location.pathname.replace(window.site_prefix,"")}var to="",ro=0,xr="",no=!1,O=class t{static get uname(){return to}static get uid(){return ro}static get token(){return xr}static set token(e){xr=e,window.localStorage.setItem("player-id",e)}static async init(){xr=window.localStorage.getItem("player-id")||"";let{body:e}=await io.default.post("/user/current").send({token:t.token});e.loggedIn?(to=e.name,ro=e.uid,no=e.isAdmin,no&&$("body").addClass("isadmin"),H()==="/login"&&R("/")):(t.token="",H()!=="/login"&&R("/login"))}};function dl(){let t=$(".page--home > .create-game > p");t.find(".submit").on("click",async()=>{let e=t.find(".player1").val()?.toString()||"",r=t.find(".player2").val()?.toString()||"",n=t.find(".startAt").val()?.toString()||"",o=t.find(".note").val()?.toString()||"",{body:i}=await Tr.default.post("/game/create").send({token:O.token,player1:e,player2:r,startAt:+n*60*1e3+Date.now(),note:o});i.error?window.alert(i.error):R("/")})}async function yl(){let{body:{list:t}}=await Tr.default.post("/game/list").send({token:O.token});for(let e of t)$(".page--home > .list > table > tbody").append(`
      <tr>
        <td>${e.gameId}</td>
        <td>${e.player1}</td>
        <td>${e.player2}</td>
        <td>${new Date(e.startAt).toLocaleString()}</td>
        <td>${e.done?e.winner:"\u6E38\u620F\u672A\u7ED3\u675F"}</td>
        <td>
          ${[e.player1,e.player2].includes(O.uid)&&!e.done?`<a href="/game/${e.gameId}/play">\u8FDB\u5165</a>`:""}
          ${e.done?`<a href="/game/${e.gameId}/replay">\u56DE\u653E</a>`:""}
        </td>
        <td>${e.note}</td>
      </tr>
    `)}async function oo(){yl(),dl()}var Or=De(xe());async function so(){let t=await Or.default.post("/user/newToken").send({token:""});$(".page--login > p.token").text(t.text.trim()),$(document).on("click",".page--login button.submit",async()=>{let e=($(".page--login .paste-id").val()?.toString()||"").trim(),{body:r}=await Or.default.post("/user/login/luogu").send({pasteId:e,token:""});r.error?window.alert(r.error):(O.token=r.token,R("/"))})}var Ho=De(xe());var B=Object.create(null);B.open="0";B.close="1";B.ping="2";B.pong="3";B.message="4";B.upgrade="5";B.noop="6";var He=Object.create(null);Object.keys(B).forEach(t=>{He[B[t]]=t});var ze={type:"error",data:"parser error"};var co=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",uo=typeof ArrayBuffer=="function",fo=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,We=({type:t,data:e},r,n)=>co&&e instanceof Blob?r?n(e):ao(e,n):uo&&(e instanceof ArrayBuffer||fo(e))?r?n(e):ao(new Blob([e]),n):n(B[t]+(e||"")),ao=(t,e)=>{let r=new FileReader;return r.onload=function(){let n=r.result.split(",")[1];e("b"+(n||""))},r.readAsDataURL(t)};function lo(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}var kr;function po(t,e){if(co&&t.data instanceof Blob)return t.data.arrayBuffer().then(lo).then(e);if(uo&&(t.data instanceof ArrayBuffer||fo(t.data)))return e(lo(t.data));We(t,!1,r=>{kr||(kr=new TextEncoder),e(kr.encode(r))})}var ho="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ge=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<ho.length;t++)Ge[ho.charCodeAt(t)]=t;var yo=t=>{let e=t.length*.75,r=t.length,n,o=0,i,s,a,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);let c=new ArrayBuffer(e),f=new Uint8Array(c);for(n=0;n<r;n+=4)i=Ge[t.charCodeAt(n)],s=Ge[t.charCodeAt(n+1)],a=Ge[t.charCodeAt(n+2)],l=Ge[t.charCodeAt(n+3)],f[o++]=i<<2|s>>4,f[o++]=(s&15)<<4|a>>2,f[o++]=(a&3)<<6|l&63;return c};var wl=typeof ArrayBuffer=="function",Ve=(t,e)=>{if(typeof t!="string")return{type:"message",data:mo(t,e)};let r=t.charAt(0);return r==="b"?{type:"message",data:bl(t.substring(1),e)}:He[r]?t.length>1?{type:He[r],data:t.substring(1)}:{type:He[r]}:ze},bl=(t,e)=>{if(wl){let r=yo(t);return mo(r,e)}else return{base64:!0,data:t}},mo=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}};var go="",wo=(t,e)=>{let r=t.length,n=new Array(r),o=0;t.forEach((i,s)=>{We(i,!1,a=>{n[s]=a,++o===r&&e(n.join(go))})})},bo=(t,e)=>{let r=t.split(go),n=[];for(let o=0;o<r.length;o++){let i=Ve(r[o],e);if(n.push(i),i.type==="error")break}return n};function vo(){return new TransformStream({transform(t,e){po(t,r=>{let n=r.length,o;if(n<126)o=new Uint8Array(1),new DataView(o.buffer).setUint8(0,n);else if(n<65536){o=new Uint8Array(3);let i=new DataView(o.buffer);i.setUint8(0,126),i.setUint16(1,n)}else{o=new Uint8Array(9);let i=new DataView(o.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(o[0]|=128),e.enqueue(o),e.enqueue(r)})}})}var Rr;function xt(t){return t.reduce((e,r)=>e+r.length,0)}function Tt(t,e){if(t[0].length===e)return t.shift();let r=new Uint8Array(e),n=0;for(let o=0;o<e;o++)r[o]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),r}function So(t,e){Rr||(Rr=new TextDecoder);let r=[],n=0,o=-1,i=!1;return new TransformStream({transform(s,a){for(r.push(s);;){if(n===0){if(xt(r)<1)break;let l=Tt(r,1);i=(l[0]&128)===128,o=l[0]&127,o<126?n=3:o===126?n=1:n=2}else if(n===1){if(xt(r)<2)break;let l=Tt(r,2);o=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(xt(r)<8)break;let l=Tt(r,8),c=new DataView(l.buffer,l.byteOffset,l.length),f=c.getUint32(0);if(f>Math.pow(2,21)-1){a.enqueue(ze);break}o=f*Math.pow(2,32)+c.getUint32(4),n=3}else{if(xt(r)<o)break;let l=Tt(r,o);a.enqueue(Ve(i?l:Rr.decode(l),e)),n=0}if(o===0||o>t){a.enqueue(ze);break}}}})}var Cr=4;function S(t){if(t)return vl(t)}function vl(t){for(var e in S.prototype)t[e]=S.prototype[e];return t}S.prototype.on=S.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};S.prototype.once=function(t,e){function r(){this.off(t,r),e.apply(this,arguments)}return r.fn=e,this.on(t,r),this};S.prototype.off=S.prototype.removeListener=S.prototype.removeAllListeners=S.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var r=this._callbacks["$"+t];if(!r)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,o=0;o<r.length;o++)if(n=r[o],n===e||n.fn===e){r.splice(o,1);break}return r.length===0&&delete this._callbacks["$"+t],this};S.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),r=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(r){r=r.slice(0);for(var n=0,o=r.length;n<o;++n)r[n].apply(this,e)}return this};S.prototype.emitReserved=S.prototype.emit;S.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};S.prototype.hasListeners=function(t){return!!this.listeners(t).length};var C=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function Ot(t,...e){return e.reduce((r,n)=>(t.hasOwnProperty(n)&&(r[n]=t[n]),r),{})}var Sl=C.setTimeout,El=C.clearTimeout;function z(t,e){e.useNativeTimers?(t.setTimeoutFn=Sl.bind(C),t.clearTimeoutFn=El.bind(C)):(t.setTimeoutFn=C.setTimeout.bind(C),t.clearTimeoutFn=C.clearTimeout.bind(C))}var _l=1.33;function Eo(t){return typeof t=="string"?Al(t):Math.ceil((t.byteLength||t.size)*_l)}function Al(t){let e=0,r=0;for(let n=0,o=t.length;n<o;n++)e=t.charCodeAt(n),e<128?r+=1:e<2048?r+=2:e<55296||e>=57344?r+=3:(n++,r+=4);return r}function _o(t){let e="";for(let r in t)t.hasOwnProperty(r)&&(e.length&&(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(t[r]));return e}function Ao(t){let e={},r=t.split("&");for(let n=0,o=r.length;n<o;n++){let i=r[n].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}var kt=class extends Error{constructor(e,r,n){super(e),this.description=r,this.context=n,this.type="TransportError"}},W=class extends S{constructor(e){super(),this.writable=!1,z(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,r,n){return super.emitReserved("error",new kt(e,r,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let r=Ve(e,this.socket.binaryType);this.onPacket(r)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,r={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(r)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let r=_o(e);return r.length?"?"+r:""}};var ko="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Pr=64,xl={},xo=0,Rt=0,To;function Oo(t){let e="";do e=ko[t%Pr]+e,t=Math.floor(t/Pr);while(t>0);return e}function Ct(){let t=Oo(+new Date);return t!==To?(xo=0,To=t):t+"."+Oo(xo++)}for(;Rt<Pr;Rt++)xl[ko[Rt]]=Rt;var Ro=!1;try{Ro=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var Co=Ro;function $r(t){let e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Co))return new XMLHttpRequest}catch{}if(!e)try{return new C[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function Tl(){}var Ol=function(){return new $r({xdomain:!1}).responseType!=null}(),Pt=class extends W{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){let n=location.protocol==="https:",o=location.port;o||(o=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||o!==e.port}let r=e&&e.forceBase64;this.supportsBinary=Ol&&!r,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";let r=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||r()})),this.writable||(n++,this.once("drain",function(){--n||r()}))}else r()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let r=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};bo(e,this.socket.binaryType).forEach(r),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,wo(e,r=>{this.doWrite(r,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",r=this.query||{};return this.opts.timestampRequests!==!1&&(r[this.opts.timestampParam]=Ct()),!this.supportsBinary&&!r.sid&&(r.b64=1),this.createUri(e,r)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new Z(this.uri(),e)}doWrite(e,r){let n=this.request({method:"POST",data:e});n.on("success",r),n.on("error",(o,i)=>{this.onError("xhr post error",o,i)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(r,n)=>{this.onError("xhr poll error",r,n)}),this.pollXhr=e}},Z=class t extends S{constructor(e,r){super(),z(this,r),this.opts=r,this.method=r.method||"GET",this.uri=e,this.data=r.data!==void 0?r.data:null,this.create()}create(){var e;let r=Ot(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd;let n=this.xhr=new $r(r);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let o in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.opts.extraHeaders[o])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var o;n.readyState===3&&((o=this.opts.cookieJar)===null||o===void 0||o.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(o){this.setTimeoutFn(()=>{this.onError(o)},0);return}typeof document<"u"&&(this.index=t.requestsCount++,t.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=Tl,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete t.requests[this.index],this.xhr=null}}onLoad(){let e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Z.requestsCount=0;Z.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Po);else if(typeof addEventListener=="function"){let t="onpagehide"in C?"pagehide":"unload";addEventListener(t,Po,!1)}}function Po(){for(let t in Z.requests)Z.requests.hasOwnProperty(t)&&Z.requests[t].abort()}var ce=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,r)=>r(e,0),Ke=C.WebSocket||C.MozWebSocket,$t=!0,$o="arraybuffer";var Do=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Dt=class extends W{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let e=this.uri(),r=this.opts.protocols,n=Do?{}:Ot(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=$t&&!Do?r?new Ke(e,r):new Ke(e):new Ke(e,r,n)}catch(o){return this.emitReserved("error",o)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let r=0;r<e.length;r++){let n=e[r],o=r===e.length-1;We(n,this.supportsBinary,i=>{let s={};$t||(n.options&&(s.compress=n.options.compress),this.opts.perMessageDeflate&&(typeof i=="string"?Buffer.byteLength(i):i.length)<this.opts.perMessageDeflate.threshold&&(s.compress=!1));try{$t?this.ws.send(i):this.ws.send(i,s)}catch{}o&&ce(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",r=this.query||{};return this.opts.timestampRequests&&(r[this.opts.timestampParam]=Ct()),this.supportsBinary||(r.b64=1),this.createUri(e,r)}check(){return!!Ke}};var It=class extends W{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{let r=So(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(r).getReader(),o=vo();o.readable.pipeTo(e.writable),this.writer=o.writable.getWriter();let i=()=>{n.read().then(({done:a,value:l})=>{a||(this.onPacket(l),i())}).catch(a=>{})};i();let s={type:"open"};this.query.sid&&(s.data=`{"sid":"${this.query.sid}"}`),this.writer.write(s).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let r=0;r<e.length;r++){let n=e[r],o=r===e.length-1;this.writer.write(n).then(()=>{o&&ce(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}};var Dr={websocket:Dt,webtransport:It,polling:Pt};var kl=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Rl=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Te(t){if(t.length>2e3)throw"URI too long";let e=t,r=t.indexOf("["),n=t.indexOf("]");r!=-1&&n!=-1&&(t=t.substring(0,r)+t.substring(r,n).replace(/:/g,";")+t.substring(n,t.length));let o=kl.exec(t||""),i={},s=14;for(;s--;)i[Rl[s]]=o[s]||"";return r!=-1&&n!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=Cl(i,i.path),i.queryKey=Pl(i,i.query),i}function Cl(t,e){let r=/\/{2,9}/g,n=e.replace(r,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function Pl(t,e){let r={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,o,i){o&&(r[o]=i)}),r}var ue=class t extends S{constructor(e,r={}){super(),this.binaryType=$o,this.writeBuffer=[],e&&typeof e=="object"&&(r=e,e=null),e?(e=Te(e),r.hostname=e.host,r.secure=e.protocol==="https"||e.protocol==="wss",r.port=e.port,e.query&&(r.query=e.query)):r.host&&(r.hostname=Te(r.host).host),z(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=r.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Ao(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){let r=Object.assign({},this.opts.query);r.EIO=Cr,r.transport=e,this.id&&(r.sid=this.id);let n=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new Dr[e](n)}open(){let e;if(this.opts.rememberUpgrade&&t.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",r=>this.onClose("transport close",r))}probe(e){let r=this.createTransport(e),n=!1;t.priorWebsocketSuccess=!1;let o=()=>{n||(r.send([{type:"ping",data:"probe"}]),r.once("packet",p=>{if(!n)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",r),!r)return;t.priorWebsocketSuccess=r.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(f(),this.setTransport(r),r.send([{type:"upgrade"}]),this.emitReserved("upgrade",r),r=null,this.upgrading=!1,this.flush())})}else{let u=new Error("probe error");u.transport=r.name,this.emitReserved("upgradeError",u)}}))};function i(){n||(n=!0,f(),r.close(),r=null)}let s=p=>{let u=new Error("probe error: "+p);u.transport=r.name,i(),this.emitReserved("upgradeError",u)};function a(){s("transport closed")}function l(){s("socket closed")}function c(p){r&&p.name!==r.name&&i()}let f=()=>{r.removeListener("open",o),r.removeListener("error",s),r.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};r.once("open",o),r.once("error",s),r.once("close",a),this.once("close",l),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||r.open()},200):r.open()}onOpen(){if(this.readyState="open",t.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0,r=this.upgrades.length;for(;e<r;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let r=new Error("server error");r.code=e.data,this.onError(r);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let n=0;n<this.writeBuffer.length;n++){let o=this.writeBuffer[n].data;if(o&&(r+=Eo(o)),n>0&&r>this.maxPayload)return this.writeBuffer.slice(0,n);r+=2}return this.writeBuffer}write(e,r,n){return this.sendPacket("message",e,r,n),this}send(e,r,n){return this.sendPacket("message",e,r,n),this}sendPacket(e,r,n,o){if(typeof r=="function"&&(o=r,r=void 0),typeof n=="function"&&(o=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;let i={type:e,data:r,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),o&&this.once("flush",o),this.flush()}close(){let e=()=>{this.onClose("forced close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),e()},n=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){t.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,r){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,r),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){let r=[],n=0,o=e.length;for(;n<o;n++)~this.transports.indexOf(e[n])&&r.push(e[n]);return r}};ue.protocol=Cr;var Wu=ue.protocol;function Io(t,e="",r){let n=t;r=r||typeof location<"u"&&location,t==null&&(t=r.protocol+"//"+r.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=r.protocol+t:t=r.host+t),/^(https?|wss?):\/\//.test(t)||(typeof r<"u"?t=r.protocol+"//"+t:t="https://"+t),n=Te(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";let i=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+i+":"+n.port+e,n.href=n.protocol+"://"+i+(r&&r.port===n.port?"":":"+n.port),n}var Fr={};zr(Fr,{Decoder:()=>Br,Encoder:()=>Lr,PacketType:()=>y,protocol:()=>Fo});var $l=typeof ArrayBuffer=="function",Dl=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,No=Object.prototype.toString,Il=typeof Blob=="function"||typeof Blob<"u"&&No.call(Blob)==="[object BlobConstructor]",Nl=typeof File=="function"||typeof File<"u"&&No.call(File)==="[object FileConstructor]";function Xe(t){return $l&&(t instanceof ArrayBuffer||Dl(t))||Il&&t instanceof Blob||Nl&&t instanceof File}function Je(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let r=0,n=t.length;r<n;r++)if(Je(t[r]))return!0;return!1}if(Xe(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return Je(t.toJSON(),!0);for(let r in t)if(Object.prototype.hasOwnProperty.call(t,r)&&Je(t[r]))return!0;return!1}function Lo(t){let e=[],r=t.data,n=t;return n.data=Ir(r,e),n.attachments=e.length,{packet:n,buffers:e}}function Ir(t,e){if(!t)return t;if(Xe(t)){let r={_placeholder:!0,num:e.length};return e.push(t),r}else if(Array.isArray(t)){let r=new Array(t.length);for(let n=0;n<t.length;n++)r[n]=Ir(t[n],e);return r}else if(typeof t=="object"&&!(t instanceof Date)){let r={};for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=Ir(t[n],e));return r}return t}function Bo(t,e){return t.data=Nr(t.data,e),delete t.attachments,t}function Nr(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let r=0;r<t.length;r++)t[r]=Nr(t[r],e);else if(typeof t=="object")for(let r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t[r]=Nr(t[r],e));return t}var Ll=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Fo=5,y;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(y||(y={}));var Lr=class{constructor(e){this.replacer=e}encode(e){return(e.type===y.EVENT||e.type===y.ACK)&&Je(e)?this.encodeAsBinary({type:e.type===y.EVENT?y.BINARY_EVENT:y.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let r=""+e.type;return(e.type===y.BINARY_EVENT||e.type===y.BINARY_ACK)&&(r+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(r+=e.nsp+","),e.id!=null&&(r+=e.id),e.data!=null&&(r+=JSON.stringify(e.data,this.replacer)),r}encodeAsBinary(e){let r=Lo(e),n=this.encodeAsString(r.packet),o=r.buffers;return o.unshift(n),o}};function qo(t){return Object.prototype.toString.call(t)==="[object Object]"}var Br=class t extends S{constructor(e){super(),this.reviver=e}add(e){let r;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");r=this.decodeString(e);let n=r.type===y.BINARY_EVENT;n||r.type===y.BINARY_ACK?(r.type=n?y.EVENT:y.ACK,this.reconstructor=new qr(r),r.attachments===0&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r)}else if(Xe(e)||e.base64)if(this.reconstructor)r=this.reconstructor.takeBinaryData(e),r&&(this.reconstructor=null,super.emitReserved("decoded",r));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let r=0,n={type:Number(e.charAt(0))};if(y[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===y.BINARY_EVENT||n.type===y.BINARY_ACK){let i=r+1;for(;e.charAt(++r)!=="-"&&r!=e.length;);let s=e.substring(i,r);if(s!=Number(s)||e.charAt(r)!=="-")throw new Error("Illegal attachments");n.attachments=Number(s)}if(e.charAt(r+1)==="/"){let i=r+1;for(;++r&&!(e.charAt(r)===","||r===e.length););n.nsp=e.substring(i,r)}else n.nsp="/";let o=e.charAt(r+1);if(o!==""&&Number(o)==o){let i=r+1;for(;++r;){let s=e.charAt(r);if(s==null||Number(s)!=s){--r;break}if(r===e.length)break}n.id=Number(e.substring(i,r+1))}if(e.charAt(++r)){let i=this.tryParse(e.substr(r));if(t.isPayloadValid(n.type,i))n.data=i;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,r){switch(e){case y.CONNECT:return qo(r);case y.DISCONNECT:return r===void 0;case y.CONNECT_ERROR:return typeof r=="string"||qo(r);case y.EVENT:case y.BINARY_EVENT:return Array.isArray(r)&&(typeof r[0]=="number"||typeof r[0]=="string"&&Ll.indexOf(r[0])===-1);case y.ACK:case y.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},qr=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let r=Bo(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function N(t,e,r){return t.on(e,r),function(){t.off(e,r)}}var Bl=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Oe=class extends S{constructor(e,r,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=r,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[N(e,"open",this.onopen.bind(this)),N(e,"packet",this.onpacket.bind(this)),N(e,"error",this.onerror.bind(this)),N(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...r){if(Bl.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(r.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(r),this;let n={type:y.EVENT,data:r};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof r[r.length-1]=="function"){let s=this.ids++,a=r.pop();this._registerAckCallback(s,a),n.id=s}let o=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!o||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,r){var n;let o=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(o===void 0){this.acks[e]=r;return}let i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);r.call(this,new Error("operation has timed out"))},o),s=(...a)=>{this.io.clearTimeoutFn(i),r.apply(this,a)};s.withError=!0,this.acks[e]=s}emitWithAck(e,...r){return new Promise((n,o)=>{let i=(s,a)=>s?o(s):n(a);i.withError=!0,r.push(i),this.emit(e,...r)})}_addToQueue(e){let r;typeof e[e.length-1]=="function"&&(r=e.pop());let n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((o,...i)=>n!==this._queue[0]?void 0:(o!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),r&&r(o)):(this._queue.shift(),r&&r(null,...i)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let r=this._queue[0];r.pending&&!e||(r.pending=!0,r.tryCount++,this.flags=r.flags,this.emit.apply(this,r.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:y.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,r){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,r),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){let n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case y.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case y.EVENT:case y.BINARY_EVENT:this.onevent(e);break;case y.ACK:case y.BINARY_ACK:this.onack(e);break;case y.DISCONNECT:this.ondisconnect();break;case y.CONNECT_ERROR:this.destroy();let n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){let r=e.data||[];e.id!=null&&r.push(this.ack(e.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let r=this._anyListeners.slice();for(let n of r)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let r=this,n=!1;return function(...o){n||(n=!0,r.packet({type:y.ACK,id:e,data:o}))}}onack(e){let r=this.acks[e.id];typeof r=="function"&&(delete this.acks[e.id],r.withError&&e.data.unshift(null),r.apply(this,e.data))}onconnect(e,r){this.id=e,this.recovered=r&&this._pid===r,this._pid=r,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:y.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let r=this._anyListeners;for(let n=0;n<r.length;n++)if(e===r[n])return r.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let r=this._anyOutgoingListeners;for(let n=0;n<r.length;n++)if(e===r[n])return r.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let r=this._anyOutgoingListeners.slice();for(let n of r)n.apply(this,e.data)}}};function fe(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}fe.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),r=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+r:t-r}return Math.min(t,this.max)|0};fe.prototype.reset=function(){this.attempts=0};fe.prototype.setMin=function(t){this.ms=t};fe.prototype.setMax=function(t){this.max=t};fe.prototype.setJitter=function(t){this.jitter=t};var ke=class extends S{constructor(e,r){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(r=e,e=void 0),r=r||{},r.path=r.path||"/socket.io",this.opts=r,z(this,r),this.reconnection(r.reconnection!==!1),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor((n=r.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new fe({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(r.timeout==null?2e4:r.timeout),this._readyState="closed",this.uri=e;let o=r.parser||Fr;this.encoder=new o.Encoder,this.decoder=new o.Decoder,this._autoConnect=r.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var r;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(r=this.backoff)===null||r===void 0||r.setMin(e),this)}randomizationFactor(e){var r;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(r=this.backoff)===null||r===void 0||r.setJitter(e),this)}reconnectionDelayMax(e){var r;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(r=this.backoff)===null||r===void 0||r.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ue(this.uri,this.opts);let r=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;let o=N(r,"open",function(){n.onopen(),e&&e()}),i=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},s=N(r,"error",i);if(this._timeout!==!1){let a=this._timeout,l=this.setTimeoutFn(()=>{o(),i(new Error("timeout")),r.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(o),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(N(e,"ping",this.onping.bind(this)),N(e,"data",this.ondata.bind(this)),N(e,"error",this.onerror.bind(this)),N(e,"close",this.onclose.bind(this)),N(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(r){this.onclose("parse error",r)}}ondecoded(e){ce(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,r){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Oe(this,e,r),this.nsps[e]=n),n}_destroy(e){let r=Object.keys(this.nsps);for(let n of r)if(this.nsps[n].active)return;this._close()}_packet(e){let r=this.encoder.encode(e);for(let n=0;n<r.length;n++)this.engine.write(r[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,r){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,r),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let r=this.backoff.duration();this._reconnecting=!0;let n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(o=>{o?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",o)):e.onreconnect()}))},r);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var Ye={};function je(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};let r=Io(t,e.path||"/socket.io"),n=r.source,o=r.id,i=r.path,s=Ye[o]&&i in Ye[o].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||s,l;return a?l=new ke(n,e):(Ye[o]||(Ye[o]=new ke(n,e)),l=Ye[o]),r.query&&!e.query&&(e.query=r.queryKey),l.socket(r.path,e)}Object.assign(je,{Manager:ke,Socket:Oe,io:je,connect:je});var Mo=[],Nt=class{constructor(e,r,n){this.$ele=$(".alert");$("h1.alert-title").text(e),$("p.alert-description").html(r);for(let o of n)$(".alert > center").append(`<div class="button-div"><button class="${o.class}" data-key="${o.key}">${o.text}</button></div>`)}open(){return new Promise(e=>{this.$ele.removeClass("hidden"),Mo.push(r=>{let n=$(r.currentTarget);n.attr("data-key")&&(this.$ele.addClass("hidden"),this.$ele.find("div.button-div").remove(),e(n.attr("data-key")))})})}};function Uo(){$(document).on("click",".alert button",t=>{Mo.forEach(e=>e(t))})}var Lt=class{constructor(e){this.game=e;this.nowSize=32;this.nowLeft=30;this.nowTop=30;this.isDown=!1;this.fromX=0;this.fromY=0;this.lastLeft=0;this.lastTop=0;this.updateTableStyle(),$(document).on("wheel",r=>this.handleWheelEvent(r.originalEvent.deltaY)),$(document).on("mousedown",r=>this.handleMouseDown(r)),$(document).on("mouseup",r=>this.handleMouseUp(r)),$(document).on("mousemove",r=>this.handleMouseMove(r))}updateSize(e){this.nowSize=e,this.updateTableStyle()}updateTableStyle(){$(".game-table-container").attr("style",[`top: ${this.nowTop}px;`,`left: ${this.nowLeft}px;`].join(" ")),this.game.$table.attr("style",[`--cell-size: ${this.nowSize}px;`,`--bg-size: ${this.nowSize/32*25}px;`,`--number-size: ${this.nowSize/32*3+9}px;`].join(" "))}handleWheelEvent(e){Math.abs(e)<1||(this.nowSize-=Math.abs(e)/e*Math.log(Math.abs(e)),this.nowSize=Math.min(Math.max(this.nowSize,16),100),this.updateTableStyle())}handleMouseDown(e){this.lastLeft=this.nowLeft,this.lastTop=this.nowTop,this.fromX=e.clientX,this.fromY=e.clientY,this.isDown=!0}handleMouseUp(e){this.isDown&&(this.isDown=!1,this.nowLeft=this.lastLeft+e.clientX-this.fromX,this.nowTop=this.lastTop+e.clientY-this.fromY,this.updateTableStyle())}handleMouseMove(e){this.isDown&&(this.nowLeft=this.lastLeft+e.clientX-this.fromX,this.nowTop=this.lastTop+e.clientY-this.fromY,this.updateTableStyle())}};var Bt=class{constructor(e){this.game=e}getPlayerHtml(e){let r=this.game.players.filter(n=>n.id===e);return r.length===0?null:`<span class="inline-color-block owner--${e}"></span>${r[0].name}`}onMessage(e){$(".chat-messages-container").append(`
      <p class="chat-message${e.from===0?" system-message":""}">
        ${e.from===0?'<span class="system-message-spacer"></span>':this.getPlayerHtml(e.from)}
        ${e.content.replace(/\{[0-9]\}/g,r=>{let n=+r.replace(/[^0-9]/g,""),o=e.params[n];return o&&this.getPlayerHtml(o)||r})}
        <span class="turn">${e.turn}${e.isHalf?".":""}</span>
      </p>
    `)}};var Re={};zr(Re,{update:()=>ql});function ql(t){$(".game-leaderboard > tbody").html(`
    <tr>
      <td><span style="white-space: nowrap;"><span style="color: gold;">\u2605 </span></span></td>
      <td>Player</td>
      <td>Army</td>
      <td>Land</td>
    </tr>
    ${t.map(e=>`
      <tr class="${e.status===3?"dead":e.status===2?"surrendered":""}">
        <td><span style="white-space: nowrap;"><span style="color: gold;">\u2605 </span>0</span></td>
        <td class="leaderboard-name owner--${e.id}">${e.name}</td>
        <td>${e.army}</td>
        <td>${e.land}</td>
      </tr>
    `).join("")}
  `)}function Ml(){let t=()=>String.fromCharCode(97+Math.floor(Math.random()*26));return`${Date.now()}${t()}${t()}${t()}${t()}`}var Mr=!1,Ce=class{constructor(){this.isReplay=!1;this.now=[];this.$table=$(".page--game_play .game-table");this.width=0;this.height=0;this.me=0;this.steps=[];this.players=[];this.gameEnded=!1;this.nowSelectX=-1;this.nowSelectY=-1;this.nowSelectStatus=3;this.game_table=new Lt(this)}endGame(){this.gameEnded=!0}updatePlayers(e){this.players=e,this.me=e.filter(r=>r.uid===O.uid)[0].id}updateMap(e){let r=e.split(";").map(i=>i.split(",")),n=Mr;if(!Mr){this.width=r[0].length,this.height=r.length;for(let i=0;i<this.height;i++)this.now.push(new Array(this.width).fill({type:"empty",owner:0,army:0}));for(let i=0;i<this.height;i++){this.$table.append(`<tr data-x="${i}"></tr>`);for(let s=0;s<this.width;s++)this.$table.find(`tr[data-x="${i}"]`).append(`<td data-x="${i}" data-y="${s}"></td>`)}$(document).on("click",".page--game_play table",i=>this.handleClickByEvent(i)),$(document).on("keydown",i=>this.handleKeydown(i)),Mr=!0}let o=[];for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++){let a=r[i][s][0],l={type:a==="g"?"general":a==="c"?"city":a==="e"?"empty":a==="m"?"mountain":a==="u"?"unknown":"obstacle",owner:+r[i][s][1],army:+r[i][s].replace(/^[a-z][0-9]/,"")};(!n||!["type","owner","army"].every(c=>this.now[i][s][c]===l[c]))&&o.push(`${i},${s}`),this.now[i][s]=l}for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)this.updateCell(i,s),o.includes(`${i},${s}`)&&this.updateSelectStatus(i,s)}async updateCell(e,r){let n=this.now[e][r],o=this.$table.find(`td[data-x="${e}"][data-y="${r}"]`),i=(o.attr("class")||"").split(" ");if(!i.includes(`type--${n.type}`)){for(let s of i.filter(a=>a.startsWith("type--")))o.removeClass(s);o.addClass(`type--${n.type}`)}if(!i.includes(`owner--${n.owner}`)){for(let s of i.filter(a=>a.startsWith("owner--")))o.removeClass(s);o.addClass(`owner--${n.owner}`)}}async updateSelectStatus(e,r,n=!1){if(this.isReplay){let u=this.$table.find(`td[data-x="${e}"][data-y="${r}"]`),m=this.now[e][r];u.html(m.army>0||m.owner===0&&m.army===0&&m.type==="city"?m.army.toString():"");return}if(e<0||r<0||e>=this.height||r>=this.width)return;n&&await Promise.all([this.updateSelectStatus(e+1,r),this.updateSelectStatus(e-1,r),this.updateSelectStatus(e,r+1),this.updateSelectStatus(e,r-1)]);let o=this.$table.find(`td[data-x="${e}"][data-y="${r}"]`),i=this.now[e][r],a=this.nowSelectX===e&&this.nowSelectY===r&&this.nowSelectStatus===2?"50%":i.army>0||i.owner===0&&i.army===0&&i.type==="city"?i.army.toString():"";function l(u,m,v,x){return u.filter(D=>D[0][0]===e&&D[0][1]===r&&D[1][0]===e+m&&D[1][1]===r+v).length>0?x:""}o.html([l(this.steps,0,-1,'<div class="center-vertical" style="left: 0px;">\u2190</div>'),l(this.steps,0,1,'<div class="center-vertical" style="right: 0px;">\u2192</div>'),l(this.steps,-1,0,'<div class="center-horizontal" style="top: 0px;">\u2191</div>'),l(this.steps,1,0,'<div class="center-horizontal" style="bottom: 0px;">\u2193</div>'),a].join(""));let c=u=>{o.hasClass(u)&&o.removeClass(u)},f=u=>{o.hasClass(u)||o.addClass(u)},p=(u,m)=>{m?f(u):c(u)};if(this.nowSelectX===e&&this.nowSelectY===r)f("selected"),c("attackable"),f("selectable");else{let u=Math.abs(this.nowSelectX-e)+Math.abs(this.nowSelectY-r)===1;u&&=i.type!=="mountain",c("selected"),p("attackable",u),p("selectable",u||i.owner===this.me)}}handleAddStep(e,r,n,o,i){this.steps.push([[e,r],[n,o],i,Ml()]),this.updateSelectStatus(e,r),this.sendSteps()}async sendSteps(){this.socket.emit("updateSteps",this.steps)}sendSurrenderMessage(){this.socket.emit("surrender")}markStepsAsDone(e){let r=this.steps.filter(n=>e.includes(n[3]));this.steps=this.steps.filter(n=>!e.includes(n[3]));for(let n of r)this.updateSelectStatus(n[0][0],n[0][1]);this.sendSteps()}async handleClick(e,r=!0){if(this.gameEnded||this.isReplay)return;let n=this.nowSelectX,o=this.nowSelectY,i=+(e.attr("data-x")||"0"),s=+(e.attr("data-y")||"0");function a(){r||(this.nowSelectStatus=3,this.nowSelectX=this.nowSelectY=-1,this.updateSelectStatus(n,o,!0))}if(typeof e.attr("data-y")!="string")return a.bind(this)();if(e.hasClass("attackable"))this.nowSelectX=i,this.nowSelectY=s,this.handleAddStep(n,o,this.nowSelectX,this.nowSelectY,this.nowSelectStatus===2),this.nowSelectStatus=1,this.updateSelectStatus(n,o,!0),this.updateSelectStatus(i,s,!0);else if(n===i&&o===s){let l=this.nowSelectStatus===2;if(l&&!r)return a.bind(this)();this.nowSelectStatus=l?1:2,this.updateSelectStatus(n,o)}else if(e.hasClass("selectable"))console.info("select position",i,s),this.nowSelectStatus=1,this.nowSelectX=i,this.nowSelectY=s,this.updateSelectStatus(n,o,!0),this.updateSelectStatus(i,s,!0);else return a.bind(this)()}handleClickByEvent(e){this.handleClick($(e.target),!1)}handleKeydown(e){if(e.code==="Digit9")return this.game_table.handleWheelEvent(20);if(e.code==="Digit0")return this.game_table.handleWheelEvent(-20);if(e.code==="Digit1")return this.game_table.updateSize(35);if(e.code==="Digit2")return this.game_table.updateSize(38);if(e.code==="Digit3")return this.game_table.updateSize(42);if(!(this.gameEnded||this.isReplay)&&this.nowSelectStatus!==3){if(["ArrowUp","KeyW"].includes(e.code))return this.handleClick(this.$table.find(`td[data-x="${this.nowSelectX-1}"][data-y="${this.nowSelectY}"]`));if(["ArrowDown","KeyS"].includes(e.code))return this.handleClick(this.$table.find(`td[data-x="${this.nowSelectX+1}"][data-y="${this.nowSelectY}"]`));if(["ArrowLeft","KeyA"].includes(e.code))return this.handleClick(this.$table.find(`td[data-x="${this.nowSelectX}"][data-y="${this.nowSelectY-1}"]`));if(["ArrowRight","KeyD"].includes(e.code))return this.handleClick(this.$table.find(`td[data-x="${this.nowSelectX}"][data-y="${this.nowSelectY+1}"]`));if(e.code==="KeyZ")return this.handleClick(this.$table.find(`td[data-x="${this.nowSelectX}"][data-y="${this.nowSelectY}"]`));if(e.code==="KeyQ"){let r=this.steps;this.steps=[];for(let n of r)this.updateSelectStatus(n[0][0],n[0][1]);return this.sendSteps()}if(e.code==="KeyE"){let r=this.steps.pop();return r?(this.updateSelectStatus(r[0][0],r[0][1]),r[1][0]===this.nowSelectX&&r[1][1]===this.nowSelectY&&(this.nowSelectX=r[0][0],this.nowSelectY=r[0][1],this.nowSelectStatus=1,this.updateSelectStatus(r[0][0],r[0][1],!0),this.updateSelectStatus(r[1][0],r[1][1],!0)),this.sendSteps()):void 0}if(e.code==="Escape")return this.sendSurrenderMessage()}}};async function Ul(){let t=+H().split("/")[2],{body:e}=await Ho.default.post("/game/info").send({token:O.token,id:t});return(e.error||![e.player1,e.player2].includes(O.uid)||e.done)&&R("/"),e}async function zo(){let t=await Ul();console.info("game.info",t);let e=new Ce,r=new Bt(e),n=je(`${window.location.protocol.replace("http","ws")}//${window.location.host}`);e.socket=n;let o;n.emit("token",O.token),n.emit("join",t.gameId),n.on("error",i=>{window.alert(i),R("/")}),n.on("update",i=>{e.markStepsAsDone(i.doneSteps),e.updatePlayers(i.players),e.updateMap(i.map),Re.update(i.players);for(let s of i.messages)r.onMessage(s);$(".page--game_play > .turn-counter").text(Date.now()>=t.startAt?`Turn ${i.turn}${i.isHalf?".":""}`:`Game will start after ${Math.ceil((t.startAt-Date.now())/1e3)} s`),t.startAt>Date.now()?o=setInterval(()=>{$(".page--game_play > .turn-counter").text(`Game will start after ${Math.ceil((t.startAt-Date.now())/1e3)} s`)},500):clearInterval(o)}),n.on("recieveMessage",i=>{r.onMessage(i)}),n.on("end",async i=>{console.info("game.end",i);let s=e.players.filter(l=>l.id===i.killBy)[0]?.name;e.endGame();let a=await new Nt(i.won?"You won!":"Game Over",i.won?"":`You were defeated by <span class="bold">${s}</span>.`,[{text:"Play Again",class:"small inverted",key:"play-again"},{text:"Watch Replay",class:"small inverted",key:"replay"},{text:"Exit",class:"inverted",key:"exit"}]).open();R("/")}),setInterval(()=>n.emit("ping"),15e3)}var Ur=De(xe());var qt=class extends Ce{constructor(r){super();this.replay=r;this.isReplay=!0;this.nowTurn=1;this.isHalf=!1;this.updateMap(this.replay.initial.join(";")),this.updateLeaderboard()}gotoTurn(r,n){let o=this.nowTurn*2+(this.isHalf?1:0)-3,i=r*2+(n?1:0)-3;if(!(i<-1||i>=this.replay.turns.length||Math.floor(i)!==i)){if($(".page--game_play > .turn-counter").text(`Turn ${r}${n?".":""}`),o<i)for(let a=o+1;a<=i;a++){let l=this.replay.turns[a].split(",");for(let c of l)c&&this.updateDiffMap(c)}else{this.updateMap(this.replay.initial.join(";"));for(let a=0;a<=i;a++){let l=this.replay.turns[a].split(",");for(let c of l)c&&this.updateDiffMap(c)}}this.updateLeaderboard(),this.nowTurn=r,this.isHalf=n}}updateLeaderboard(){let r={},n={};for(let i=0;i<this.now.length;i++)for(let s=0;s<this.now[0].length;s++){let{owner:a,army:l}=this.now[i][s];n[a]=(n[a]||0)+1,r[a]=(r[a]||0)+l}let o=Object.entries(this.replay.idToPlayer).map(([i,s])=>({id:+i,uid:s,name:s.toString(),army:r[+i]||0,land:n[+i]||0,status:(n[+i]||0)===0?3:1})).sort((i,s)=>i.army===s.army?s.land-i.land:s.army-i.army);Re.update(o)}updateDiffMap(r){let n=+r.replace(/[a-z]\d+/,""),o=Math.floor(n/this.now[0].length),i=n%this.now[0].length,s=r.replace(/\d/g,"");this.now[o][i].type=s==="g"?"general":s==="c"?"city":s==="e"?"empty":"mountain";let a=r.replace(/\d+[a-z]/,"");this.now[o][i].owner=+a[0],this.now[o][i].army=+a.slice(1),this.updateCell(o,i),this.updateSelectStatus(o,i)}};async function zl(){if(window.site_prefix!==""){let r=(window.location.search.split("?id=")[1]||"").split("&")[0];try{let{body:n}=await Ur.default.get(`/generals-replays/replays/${r}.json`);return n}catch(n){return console.error(n),window.alert("\u627E\u4E0D\u5230\u8BE5\u56DE\u653E\u3002"),R("/")}}let t=+H().split("/")[2],{body:e}=await Ur.default.post("/game/replay").send({token:O.token,id:t});return e.error&&R("/"),e.replay}async function Wo(){let t=await zl();console.info("game.replay",t);let e=new qt(t);setInterval(()=>{e.isHalf?e.gotoTurn(e.nowTurn+1,!1):e.gotoTurn(e.nowTurn,!0)},500)}var Go={};function Ze(t,e){Go[t]={page:t,init:e},console.info(`Registered page ${t}`)}var Qe="";function et(t){console.info(`Going to page ${t}`),Qe&&$(`.page.page--${Qe}`).removeClass("active"),Qe=t,Go[Qe].init(),$(`.page.page--${Qe}`).addClass("active")}Ze("home",oo);Ze("login",so);Ze("game_play",zo);Ze("game_replay",Wo);$(async()=>{Uo(),window.site_prefix===""&&await O.init();let t=H();/^\/login$/.test(t)?et("login"):/^\/$/.test(t)?et("home"):/^\/game\/[1-9][0-9]*?\/play$/.test(t)?et("game_play"):/^\/game\/[1-9][0-9]*?\/replay$/.test(t)||window.site_prefix!==""?et("game_replay"):R("/")});})();
